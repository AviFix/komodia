<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head profile="http://purl.org/uF/hAtom/0.1/ http://purl.org/uF/2008/03/">
	
	<title>Challenges</title>

	<!-- Meta Tags -->
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="generator" content="WordPress" />
	<meta name="framework" content="WP Framework" />

	<!-- Favicon: Browser + iPhone Webclip -->
	<link rel="shortcut icon" href="../wp-content/themes/wp-framework/images/favicon.jpg" />

	<!-- Stylesheets -->
	<link rel="stylesheet" href="../wp-content/themes/wp-framework/style.css" type="text/css" media="screen, projection" />
	<link rel="stylesheet" href="../wp-content/themes/wp-framework/library/media/css/print.css" type="text/css" media="print" />

  	<!-- Links: RSS + Atom Syndication + Pingback etc. -->
	<link rel="alternate" type="application/rss+xml" title="Komodia RSS Feed" href="../feed/rss" />
	<link rel="alternate" type="text/xml" title="RSS .92" href="../feed/rss" />
	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="../feed/atom" />
	<link rel="pingback" href="../xmlrpc.php" />

	<!-- Theme Hook -->
    	<link rel="alternate" type="application/rss+xml" title="Komodia &raquo; Challenges Comments Feed" href="feed" />
<link rel='stylesheet' id='really_simple_share_style-css'  href='../wp-content/plugins/really-simple-facebook-twitter-share-buttons/style.css' type='text/css' media='all' />
<!-- This site uses the Yoast Google Analytics plugin v5.2.7 - Universal disabled - https://yoast.com/wordpress/plugins/google-analytics/ -->
<script type="text/javascript">

	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-34315916-1']);
	_gaq.push(['_gat._forceSSL']);
	_gaq.push(['_trackPageview']);

	(function () {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();

</script>
<!-- / Yoast Google Analytics -->
<script type='text/javascript' src='../wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='../wp-includes/js/jquery/jquery-migrate.min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc.php@rsd" />
<link rel='shortlink' href='../index.html@p=510.html' />

<!-- All in One SEO Pack 2.2.3.1 by Michael Torbert of Semper Fi Web Design[245,299] -->
<meta name="description"  content="This page covers all challenges relating development of network interception product, some are shared across redirection technologies, some are specific to" />

<link rel="canonical" href="../index.html@p=510.html" />
<!-- /all in one seo pack -->
	<script type="text/javascript">
		function showSub(idname){
			document.getElementById(idname).style.display = "block";
		}
		function hideSub(idname){
			document.getElementById(idname).style.display = "none";
		}
	</script>
<!--END head-->
</head>
<body >
<div class="container top-space">
	<div id="header">
    	<div id="logo-holder"><a href="../index.php.html"><img src="../wp-content/themes/wp-framework/images/logo.gif" alt="Komodia Logo" border="0" /></a></div>
        <div id="menu-holder">
        	<div class="menu-left">&nbsp;</div>
        	<div class="menu-body">
        	<ul>
            	<li onmouseover="showSub('products')" onmouseout="hideSub('products')">
                	<a href="../index.php@page=products.html">Products</a>
                    <div id="products" class="submenu">                    
                     <ul>
                    	<li><a href="../index.php@page=redirector.html">Komodia's Redirector</a></li>
                        
                        <li><a href="../index.php@page=ssl.html">Komodia's SSL Digestor</a></li>
                        <li><a href="../index.php@page=rlsp.html">Komodia's Advanced LSP Installer</a></li>
                        <li><a href="../products/komodias-watchdog/index.html">Komodia's Watchdog</a></li>
			<li><a href="../products/ios/index.html">Komodia's iOS SDK</a></li>
			<li><a href="http://url.komodia.com">Komodia's classification service</a></li>
			<li><a href=http://www.komodia.com/client-side-per-page-classification-sdk">Client side classification SDK</a></li>
			<li><a href="../parental-control-demo/index.html">Parental control demo</a></li>
			<li><a href="../ad-injection-sdk/index.html">Ad injection SDK</a></li>
                    </ul>
                    <div class="clearer"></div>
                    </div>
				</li>
                <li onmouseover="showSub('lsp')" onmouseout="hideSub('lsp')">
                	<a href="../index.php@page=lsp.html">LSP</a>
                    <div id="lsp" class="submenu">
                    	<ul>
                            <li><a href="../index.php@page=lsp.html">LSP Guide</a></li>
                            <li><a href="../index.php@page=lspsamp.html">LSP Sample</a></li>
			    <li><a href="index.html">LSP development challenges</a></li>
			    <li><a href="../index.php@page=ndis.html">NDIS Guide</a></li>
			    <li><a href="../index.php@page=wfp.html">WFP Guide</a></li>
			    <li><a href="../index.php@page=tdi.html">TDI Guide</a></li>
			    <li><a href="../dll-injection/index.html">DLL injection</a></li>

						</ul>                            
                    </div>
                </li>
                <li onmouseover="showSub('about')" onmouseout="hideSub('about')">
                	<a href="../index.html@p=2.html">About Us</a>
                    <div id="about" class="submenu">
                    	<ul>
                        	<li><a href="../index.html@p=2.html">Company Information</a></li>
                            <li><a href="../index.html@p=155.html">Portfolio</a></li>
                            <li><a href="../index.html@p=170.html">Services</a></li>
                        </ul>
                    </div>
				</li>
                <li><a href="../index.php@page=newcontact.html" style="background:none;">Contact Us</a></li>
            </ul>
            </div>
            <div class="menu-right">&nbsp;</div>
            <div class="clearer"></div>
        </div>
        <div id="scanned-by"></div>
        <div class="clearer"></div>
	</div>
    <div class="center breadcrumb">
    	<span>&raquo;<a href="../index.php.html">Komodia</a> Â» Challenges</span>
    </div>		<script type="text/javascript">
</script>
    <div id="main">
    	<div id='fb-root'></div>
					<script type='text/javascript'>
						window.fbAsyncInit = function()
						{
							FB.init({appId: null, status: true, cookie: true, xfbml: true});
						};
						(function()
						{
							var e = document.createElement('script'); e.async = true;
							e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
							document.getElementById('fb-root').appendChild(e);
						}());
					</script>	
					        	<p>This page covers all challenges relating development of network interception product, some are shared across redirection technologies, some are specific to them.</p>
<h3>LSP</h3>
<h4>Bugs in LSP sample</h4>
<p>The default Microsoft sample everyone is using (including Komodia) and has built in bugs that must be fixed (just to clarify, Komodia had <strong>fixed</strong> all the bugs mentioned here): </p>
<ul>
<li>Doesn&#8217;t work with Safari 5.1 and iTunes 10.5</li>
<li>World of Warcraft sometimes hangs on startup.</li>
<li>Firefox 6.0 and above may hang on high volume traffic.</li>
<li>LSP will not intercept FF 4.0 and above on Win7.</li>
<li>Will hang IPSec on Windows XP/2003.</li>
<li>General bugs with overlapped operations.</li>
</ul>
<h4>Other challenges with LSP development</h4>
<p>Also when developing your LSP you need to take care of the following issues:</p>
<ul>
<li>Problem with apps that use SetFileCompletionNotificationModes on Windows Vista and above, causing problems connecting to MSSQL, you can read more about it <a href="../index.html@p=793.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/setfilecompletionnotificationmodes-and-non-ifs-lsp', 'here']);" >here</a>.
<li>Support overlap operations for browsers like Chrome and other applications</li>
<li>Know how to handle Admin and UAC privileges under Vista and above</li>
<li>Know how to communicate with your LSP, some methods will not work across all OS or 32/64bit difference</li>
<li>Remote debugging, once you do have a bug, how can you remotely know why, you need to know what to log in order to resolve it quickly</li>
</ul>
<p>If you decide to develop your own solution we recommend that you start with supporting Chrome, Safari and FF on Windows 7, because they will pose most problems. If you start on IE and after three months comes with a solution and then later struggle to make it work for the other browsers, you just wasted three months.</p>
<h4>LSP conflicts and OS compatibility</h4>
<p>There are LSP conflicts that will occur with other LSPs, so you need to make sure your installer knows how to deal with 3rd party LSP and put your LSP in the right place, some LSPs will require you to be first in the chain, some last, you can only know that after investigating those LSPs manualy, keep in mind that the default installer doesn&#8217;t support too much out of the box, you will need to add at least 5000 lines of code to make it support all the scenarios you want (layering before or after a provider, doing a provider bypass, layering over base providers only, supporting Windows in various languages)</p>
<p>Once you are done, you need to make sure your LSP works with Anti Viruses, you need to check 40 brands against 5 browsers across 20 flavors of Windows.</p>
<h4>Komodia&#8217;s LSP solution</h4>
<p>Our <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> already have all of these solved, and each month we get at least one item new to add because of the speed which the software world change, overall it took us one and a half year to get something stable that works also outside of the VM.</p>
<h3>NDIS</h3>
<p>NDIS is a kernel driver and works on packets level, therefore most of the work must be done on packet parsing, and you will need to code these features:</p>
<ul>
<li>Reconstruct the TCP/IP stream, remove duplicate packets and acks.</li>
<li>If you plan to modify data, you need to adjust ID and seq numbers.</li>
<li>Make sure your driver supports various VPNs.</li>
<li>Make sure your driver supports 3G networks.</li>
<li>Doesn&#8217;t work with localhost.</li>
</ul>
<h4>Komodia&#8217;s solution</h4>
<p>In <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> we chose not to used NDIS mainly because of the limitation of LocalHost and VPN/3G, some products do use it for workstation but we believe it&#8217;s more of a server technology.</p>
<h3>WFP</h3>
<p>WFP can work either at packet level or stream level, which one to choose is up to your implementation, the challenges with WFP are:</p>
<ul>
<li>Some functionality will not work on Vista (depending on the SP)</li>
<li>You need to install it correctly so it will load on startup</li>
<li>It&#8217;s quite new, so it&#8217;s hard to find information about it</li>
<li>You need different code for Windows Vista, Windows 7, Windows 8</li>
<li>WFP on Windows 8 requires to implement a special chain of redirection so you&#8217;d be able to work with other WFP drivers</li>
</ul>
<h4>Komodia&#8217;s solution</h4>
<p>In <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> we have an option to use WFP, it took us three months to develop it on top of our pre-existing solution and another three months to make it Windows 8 ready.</p>
<h3>DLL injection</h3>
<p>DLL injection is used when you don&#8217;t want to require the user to have admin privileges, the challenges with DLL injection are:</p>
<ul>
<li>Which hooking library to use, some are very high prices (like MS detours, remember it&#8217;s free only for free apps, and doesn&#8217;t come with the 64bit version for the free version), some are free but are identified as a Virus by most majors AV providers.</li>
<li>Some games will detect DLL injection as an attempt to hack, and will result in banning the players account, make sure your app knows how to handle it.</li>
<li>You need to make sure you know how to handle 32bit and 64bit processes the hooking is different, also it&#8217;s very hard to do an injection from a 64bit service to a 32bit process.</li>
<li>You can inject into Windows Metro, but can&#8217;t redirect Winsock traffic to localhost.</li>
</ul>
<h4>Komodia&#8217;s solution</h4>
<p>In <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> we use a LSP, we believe this is the way to go. Like previously said, the only situation where DLL injection is needed is that if you don&#8217;t want to require admin privileges.</p>
<h3>HTTP Parsing</h3>
<p>After you sorted out the redirection component you need to make sure you can read the HTTP traffic correctly, while parsing the data you need to make sure you can handle the following:</p>
<ul>
<li>Some servers doesn&#8217;t use \r\n for line termination.</li>
<li>Know how to decode gzip.</li>
<li>Know how to decode inflate and handle differences between web servers.</li>
<li>Know how to decode SDCH encoding.</li>
<li>Know how to parse chunked transfer.</li>
<li>Know how to handle HTTP 100 continue.</li>
<li>Know how to redirect a web page correctly.</li>
<li>Know how to handle variations across browsers.</li>
<li>Know how to handle POST correctly.</li>
<li>Know how to aggregate some content while not intercepting other based on rules.</li>
</ul>
<h4>Komodia&#8217;s solution</h4>
<p>In <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> the component development and QA in the field took about six months, it&#8217;s a very complex component, but for our clients the API is very simple.</p>
<h3>SSL decoding</h3>
<p>If you want to inspect SSL traffic you need to know to decrypt SSL, the method is very complex to implement, we wrote a short article on how: <a href="../wiki/index.php@title=SSL_Digestor.html#How_does_it_work.3F" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/wiki/index.php?title=SSL_Digestor#How_does_it_work.3F', 'SSL Decoding']);"  target="_blank">SSL Decoding</a> works.</p>
<p>Challenges when implementing this method are:</p>
<ul>
<li>Know how to install CA cert for Windows store.</li>
<li>Know how to install CA cert for Firefox store.</li>
<li>Know how to install Ca cert for Opera (there&#8217;s no API, you have to reverse engineer their store structure).</li>
<li>Know how to clone certificates correctly.</li>
<li>Know how to detect if a certificate is valid or not.</li>
<li>SSL has many features, some sites require that you enable or disable SSL features in order to work, some sites will not accept TLS (modern SSL) and you will have to fall back to SSLv3.</li>
<li>On Windows 7 know to how to download root/intermediate certificates in real time for validation.</li>
</ul>
<h4>Komodia&#8217;s solution</h4>
<p>In <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> it&#8217;s the most complex component, overall with all the field QA and bugfixes it took one year to make the component stable as it is know.</p>
<h3>Intercepting DNS</h3>
<p>There are number of ways to do it, and it depends on your needs, basically there are a few ways to do it, the challenges are:</p>
<ul>
<li>Knowing which method is best for your specific scenario.</li>
<li>Once you know which scenario you want, you need to choose the best technology for the job, a wrong choice may mean starting over, for example it&#8217;s important to decide up front which OS you want to support, not all technologies support all OSs, and connection types.</li>
</ul>
<h4>Komodia&#8217;s solution</h4>
<p>In <a href="../index.php@page=redirector.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/products/komodia-redirector/', 'Komodia&#8217;s Redirector']);" >Komodia&#8217;s Redirector</a> we have a DNS hijacking module, it is used mostly for anonymizing and it is using hooks to control the app DNS methods, you can read about <a href="../wiki/index.php@title=DNS_hijack.html" onclick="_gaq.push(['_trackEvent', 'outbound-article-int', 'http://www.komodia.com/wiki/index.php?title=DNS_hijack', 'how it works']);" >how it works</a>.</p>
<h3>Field QA</h3>
<p>What&#8217;s field QA, it doesn&#8217;t matter how much tests you&#8217;ll do in house, in the field you will have strange variations you couldn&#8217;t possibly think of, for example a system with: firewall, corporate firewall, AV solution and a proxy (just an example), you can&#8217;t cover all bases that&#8217;s why QA takes more then development because all of these field QA which is more common then you may thing.</p>
<div class='wpfblike' style='height: 40px;'><fb:like href='http://www.komodia.com/challenges' layout='standard' show_faces='true' width='400' action='like' colorscheme='light' send='false' /></div>            </div>
</div>
<img src="http://www.googleadservices.com/pagead/conversion/958761171/?value=0&label=byAaCJ3LkgQQ05GWyQM&guid=ON&script=0" alt="" height="1" width="1" style="border-style:none;" /><script type="text/javascript">
        //<![CDATA[
        
      !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
      
      window.___gcfg = {lang: "en"};
		  (function() {
		    var po = document.createElement("script"); po.type = "text/javascript"; po.async = true;
		    po.src = "https://apis.google.com/js/plusone.js";
		    var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s);
		  })();
      
        //]]>
  		</script>
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script><!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.komodia.com/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->
<script type='text/javascript' src='https://platform.linkedin.com/in.js'></script>
<script type='text/javascript' src='../wp-includes/js/hoverIntent.min.js'></script>
<script type='text/javascript' src='../wp-includes/js/comment-reply.min.js'></script>
<div id="footer" class="container">
	<p>Copyright &copy; 2000-2013 Komodia Inc. All rights reserved.</p>
    <div id="footer-menu">
    	<ul>
        	<li><a href="../index.php@page=about.html">About Us</a></li>
		 <li><a href="../index.html@p=673.html">Press releases</a></li>
		<li><a href="../index.html@p=743.html">Newsletters</a></li>
            <li><a href="../index.html@p=701.html">Blogs</a></li>
            <li><a href="../wiki/index.php@title=Main_Page.html" target="_blank">Wiki</a></li>
            <li><a href="../videos/index.html">Videos</a></li>
		<li><a href="../wiki/index.php@title=Komodia%2527s_site_legal_information.html" target="_blank">Privacy</a></li>

            <li><a id="fb" href="http://www.facebook.com/komodia#!/pages/Komodia/129677207087283" target="_blank">Visit Us on Facebook</a></li>
        </ul>
    </div>
    <div class="clearer"></div>
</div>
</body>
</html>
<!-- Performance optimized by W3 Total Cache. Learn more: http://www.w3-edge.com/wordpress-plugins/

Page Caching using disk: enhanced
Database Caching 1/6 queries in 0.002 seconds using disk
Object Caching 499/509 objects using disk

 Served from: www.komodia.com @ 2014-12-19 23:33:09 by W3 Total Cache -->