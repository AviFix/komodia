<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>Komodia's Advanced LSP Installer - Komodia</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.20.4" />
<meta name="robots" content="noindex,follow" />
<link rel="shortcut icon" href="../favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Komodia (en)" />
<link rel="EditURI" type="application/rsd+xml" href="api.php@action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Komodia Atom feed" href="index.php@title=Special%253ARecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php@debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.monobook&amp;only=styles&amp;printable=1&amp;skin=monobook&amp;%252A.css" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: komod_wikidb:resourceloader:filter:minify-css:7:dffa96a73b1be9b0dae7e17005fcc939 */</style>

<script src="load.php@debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=monobook&amp;%252A"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Komodia\'s_Advanced_LSP_Installer","wgTitle":"Komodia\'s Advanced LSP Installer","wgCurRevisionId":540,"wgArticleId":37,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Komodia\'s_Advanced_LSP_Installer","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: komod_wikidb:resourceloader:filter:minify-js:7:c89fc005766e312c555f83b307d08d63 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Komodia_s_Advanced_LSP_Installer skin-monobook action-view">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading"><span dir="auto">Komodia's Advanced LSP Installer</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From Komodia</div>
		<div id="contentSub"></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#column-one">navigation</a>, <a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Komodia's Advanced LSP Installer is used to install LSP easily on all Windows platform, it's a derviative work of the default Micorosft installer, with additional 10,000 lines of code to handle all the situations the default installer doesn't.
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Short_guide"><span class="tocnumber">1</span> <span class="toctext">Short guide</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Install"><span class="tocnumber">1.1</span> <span class="toctext">Install</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Update"><span class="tocnumber">1.2</span> <span class="toctext">Update</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Uninstalling"><span class="tocnumber">1.3</span> <span class="toctext">Uninstalling</span></a>
<ul>
<li class="toclevel-3 tocsection-5"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Full_uninstall"><span class="tocnumber">1.3.1</span> <span class="toctext">Full uninstall</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Specific_LSP_uninstall"><span class="tocnumber">1.3.2</span> <span class="toctext">Specific LSP uninstall</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Show_all_LSPs_installed"><span class="tocnumber">1.3.3</span> <span class="toctext">Show all LSPs installed</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Show_LSPs_installed_and_change_exit_code"><span class="tocnumber">1.3.4</span> <span class="toctext">Show LSPs installed and change exit code</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#LSP_requirements"><span class="tocnumber">2</span> <span class="toctext">LSP requirements</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Bug_fixes"><span class="tocnumber">3</span> <span class="toctext">Bug fixes</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Full_guide"><span class="tocnumber">4</span> <span class="toctext">Full guide</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Introduction"><span class="tocnumber">4.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-13"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Naming_and_licensing"><span class="tocnumber">4.2</span> <span class="toctext">Naming and licensing</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#IFS_and_Non-IFS_LSP"><span class="tocnumber">4.3</span> <span class="toctext">IFS and Non-IFS LSP</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#LSP_dummy_entry"><span class="tocnumber">4.4</span> <span class="toctext">LSP dummy entry</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Autopilot"><span class="tocnumber">4.5</span> <span class="toctext">Autopilot</span></a>
<ul>
<li class="toclevel-3 tocsection-17"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Syntax"><span class="tocnumber">4.5.1</span> <span class="toctext">Syntax</span></a></li>
<li class="toclevel-3 tocsection-18"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Practical_examples"><span class="tocnumber">4.5.2</span> <span class="toctext">Practical examples</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Vista.2F7_permissions"><span class="tocnumber">4.5.3</span> <span class="toctext">Vista/7 permissions</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#If_LSP_already_exists"><span class="tocnumber">4.5.4</span> <span class="toctext">If LSP already exists</span></a></li>
<li class="toclevel-3 tocsection-21"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#How_the_autopilot_works"><span class="tocnumber">4.5.5</span> <span class="toctext">How the autopilot works</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-22"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Uninstalling_an_LSP"><span class="tocnumber">4.6</span> <span class="toctext">Uninstalling an LSP</span></a>
<ul>
<li class="toclevel-3 tocsection-23"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Uninstall_all_installed_LSPs"><span class="tocnumber">4.6.1</span> <span class="toctext">Uninstall all installed LSPs</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Uninstalling_a_specific_LSP_using_its_ID"><span class="tocnumber">4.6.2</span> <span class="toctext">Uninstalling a specific LSP using its ID</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Uninstalling_a_specific_LSP_using_its_name"><span class="tocnumber">4.6.3</span> <span class="toctext">Uninstalling a specific LSP using its name</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Disabling_file_removal_on_reboot"><span class="tocnumber">4.6.4</span> <span class="toctext">Disabling file removal on reboot</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-27"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Displaying_LSP_stack_information"><span class="tocnumber">4.7</span> <span class="toctext">Displaying LSP stack information</span></a>
<ul>
<li class="toclevel-3 tocsection-28"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Basic_output"><span class="tocnumber">4.7.1</span> <span class="toctext">Basic output</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Chain_structure_output"><span class="tocnumber">4.7.2</span> <span class="toctext">Chain structure output</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Displaying_layered_LSPs_only"><span class="tocnumber">4.7.3</span> <span class="toctext">Displaying layered LSPs only</span></a></li>
<li class="toclevel-3 tocsection-31"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Verbose_display"><span class="tocnumber">4.7.4</span> <span class="toctext">Verbose display</span></a></li>
<li class="toclevel-3 tocsection-32"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#How_to_build_a_scenario_file"><span class="tocnumber">4.7.5</span> <span class="toctext">How to build a scenario file</span></a>
<ul>
<li class="toclevel-4 tocsection-33"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Why_use_a_scenario_file.3F"><span class="tocnumber">4.7.5.1</span> <span class="toctext">Why use a scenario file?</span></a></li>
<li class="toclevel-4 tocsection-34"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Using_the_scenario_file"><span class="tocnumber">4.7.5.2</span> <span class="toctext">Using the scenario file</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-35"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Sanity_checks_and_backup_operations"><span class="tocnumber">4.8</span> <span class="toctext">Sanity checks and backup operations</span></a>
<ul>
<li class="toclevel-3 tocsection-36"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Checking_winsock_integrity"><span class="tocnumber">4.8.1</span> <span class="toctext">Checking winsock integrity</span></a></li>
<li class="toclevel-3 tocsection-37"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Checking_LSP_chain_integrity"><span class="tocnumber">4.8.2</span> <span class="toctext">Checking LSP chain integrity</span></a></li>
<li class="toclevel-3 tocsection-38"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Backing_up_the_winsock_stack"><span class="tocnumber">4.8.3</span> <span class="toctext">Backing up the winsock stack</span></a></li>
<li class="toclevel-3 tocsection-39"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Restoring_the_winsock_stack"><span class="tocnumber">4.8.4</span> <span class="toctext">Restoring the winsock stack</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-40"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Manual_installation"><span class="tocnumber">4.9</span> <span class="toctext">Manual installation</span></a>
<ul>
<li class="toclevel-3 tocsection-41"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_over_other_providers_based_on_their_IDs"><span class="tocnumber">4.9.1</span> <span class="toctext">Installing over other providers based on their IDs</span></a></li>
<li class="toclevel-3 tocsection-42"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_an_IFS_LSP"><span class="tocnumber">4.9.2</span> <span class="toctext">Installing an IFS LSP</span></a></li>
<li class="toclevel-3 tocsection-43"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_over_other_providers_based_on_their_names"><span class="tocnumber">4.9.3</span> <span class="toctext">Installing over other providers based on their names</span></a></li>
<li class="toclevel-3 tocsection-44"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_over_another_LSP_based_on_either_its_name_or_its_ID"><span class="tocnumber">4.9.4</span> <span class="toctext">Installing over another LSP based on either its name or its ID</span></a></li>
<li class="toclevel-3 tocsection-45"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_over_an_existing_chain"><span class="tocnumber">4.9.5</span> <span class="toctext">Installing over an existing chain</span></a>
<ul>
<li class="toclevel-4 tocsection-46"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_LSP_first_in_the_chain"><span class="tocnumber">4.9.5.1</span> <span class="toctext">Installing LSP first in the chain</span></a></li>
<li class="toclevel-4 tocsection-47"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installing_LSP_last_in_the_chain"><span class="tocnumber">4.9.5.2</span> <span class="toctext">Installing LSP last in the chain</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-48"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#64Bit"><span class="tocnumber">4.10</span> <span class="toctext">64Bit</span></a></li>
<li class="toclevel-2 tocsection-49"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Working_with_the_DLL_installer"><span class="tocnumber">4.11</span> <span class="toctext">Working with the DLL installer</span></a>
<ul>
<li class="toclevel-3 tocsection-50"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#When_to_use_the_DLL_installer"><span class="tocnumber">4.11.1</span> <span class="toctext">When to use the DLL installer</span></a></li>
<li class="toclevel-3 tocsection-51"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Linking_with_the_DLL"><span class="tocnumber">4.11.2</span> <span class="toctext">Linking with the DLL</span></a></li>
<li class="toclevel-3 tocsection-52"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Installer_API"><span class="tocnumber">4.11.3</span> <span class="toctext">Installer API</span></a>
<ul>
<li class="toclevel-4 tocsection-53"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#AddParam.2C_Execute.2C_ResetParam"><span class="tocnumber">4.11.3.1</span> <span class="toctext">AddParam, Execute, ResetParam</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-54"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Subverting_output"><span class="tocnumber">4.11.4</span> <span class="toctext">Subverting output</span></a>
<ul>
<li class="toclevel-4 tocsection-55"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#GetOutputDataSize"><span class="tocnumber">4.11.4.1</span> <span class="toctext">GetOutputDataSize</span></a></li>
<li class="toclevel-4 tocsection-56"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#GetOutputData"><span class="tocnumber">4.11.4.2</span> <span class="toctext">GetOutputData</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-57"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Vista_API"><span class="tocnumber">4.11.5</span> <span class="toctext">Vista API</span></a>
<ul>
<li class="toclevel-4 tocsection-58"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#IsVista"><span class="tocnumber">4.11.5.1</span> <span class="toctext">IsVista</span></a></li>
<li class="toclevel-4 tocsection-59"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#IsElevated"><span class="tocnumber">4.11.5.2</span> <span class="toctext">IsElevated</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-60"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Getting_the_installed_LSP_list"><span class="tocnumber">4.11.6</span> <span class="toctext">Getting the installed LSP list</span></a>
<ul>
<li class="toclevel-4 tocsection-61"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#GetInstalledLSPs"><span class="tocnumber">4.11.6.1</span> <span class="toctext">GetInstalledLSPs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-62"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Working_with_the_COM_installer"><span class="tocnumber">4.12</span> <span class="toctext">Working with the COM installer</span></a>
<ul>
<li class="toclevel-3 tocsection-63"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;printable=yes.html#Registering_the_DLL"><span class="tocnumber">4.12.1</span> <span class="toctext">Registering the DLL</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Short_guide"> Short guide </span></h1>
<h2> <span class="mw-headline" id="Install"> Install </span></h2>
<p>To install your LSP, run the RegisterLSP in the same directory the LSP is (the RLSP will copy it to system32)
</p>
<pre>
RegisterLSP -b -d YourDLL.dll
</pre>
<h2> <span class="mw-headline" id="Update"> Update </span></h2>
<p>Updating the LSP is same as installing, replace the LSP in the install directory and run the install command, the RLSP will do all the work needed
</p>
<h2> <span class="mw-headline" id="Uninstalling"> Uninstalling </span></h2>
<p>There are two ways to uninstall the LSP
</p>
<h3> <span class="mw-headline" id="Full_uninstall"> Full uninstall </span></h3>
<pre>
RegisterLSP -f
</pre>
<p>Will remove all installed LSPs
</p>
<h3> <span class="mw-headline" id="Specific_LSP_uninstall"> Specific LSP uninstall </span></h3>
<pre>
RegisterLSP -q LSPName
</pre>
<h3> <span class="mw-headline" id="Show_all_LSPs_installed"> Show all LSPs installed </span></h3>
<pre>
RegisterLSP - p
</pre>
<h3> <span class="mw-headline" id="Show_LSPs_installed_and_change_exit_code"> Show LSPs installed and change exit code </span></h3>
<pre>
RegisterLSP -lr
</pre>
<p>Exit code will change based on the LSP status:
</p>
<ul><li> 0 - No LSPs found.
</li><li> 1 - Only our LSP detected.
</li><li> 2 - Only 3rd party LSP detected.
</li><li> 3 - Both our LSP and 3rd party LSP detected.
</li></ul>
<h1> <span class="mw-headline" id="LSP_requirements"> LSP requirements </span></h1>
<p>Your LSP must implement and expose the GetLspGuid function which returns the LSP specific GUID:
</p>
<pre>
void WSPAPI GetLspGuid(LPGUID lpGuid)
</pre>
<h1> <span class="mw-headline" id="Bug_fixes"> Bug fixes </span></h1>
<p>Can be viewed here: <a href="index.php/Komodia's_Advanced_LSP_Installer_bug_fixes.html" title="Komodia's Advanced LSP Installer bug fixes">Komodia's Advanced LSP Installer bug fixes</a>
</p>
<h1> <span class="mw-headline" id="Full_guide"> Full guide </span></h1>
<h2> <span class="mw-headline" id="Introduction"> Introduction </span></h2>
<p>This manual covers all the options supported by Komodia’s advanced installer. Throughout this manual, the terms “installer” and “RegisterLSP” will refer to Komodia’s advanced installer. It’s important to keep in mind that although a small subset of the options is found in the default Microsoft SDK installer, the core functionality described here is unique to Komodia’s installer.
</p><p>This manual briefly discusses some LSP technical issues in order to give a reader unfamiliar with LSP a firmer grasp of the subject. However, this cannot substitute for a full understanding. A good place to start is <a class="external text" href="../index.php@page=lsp.html">LSP guide</a>.
</p>
<h2> <span class="mw-headline" id="Naming_and_licensing"> Naming and licensing </span></h2>
<p>When RegisterLSP is licensed, it is for a single LSP name only. That is why we have omitted the –n flag which exists in the Microsoft installer and allows to change the name of the LSP.
</p>
<h2> <span class="mw-headline" id="IFS_and_Non-IFS_LSP"> IFS and Non-IFS LSP </span></h2>
<p>Before delving into the mechanics of the actual install process, we need to briefly review the differences between IFS and non IFS LSP (for more in-depth coverage of this topic and of the structure of the LSP stack, you can refer to my book.)
</p><p>IFS LSP uses an actual OS I/O handle per socket, which means that handles passed from the LSP to the upper layer or application do not need translation.
</p><p>Non-IFS LSP allocates its own handle per socket, which means that handles passed from the LSP to the upper layer of application must be translated by the LSP when it passes all the commands to its lower-layer LSP or base provider.
</p><p>It is important to understand that from an installer point of view, each LSP needs to be installed differently. Non-IFS LSP can be layered into any position in the stack. IFS LSP must be installed first after the base providers or after another IFS-based LSP. However, IFS LSP cannot be installed after a Non-IFS LSP. Another important point is that the installer needs to set a special
flag to denote that the IFS LSP is installed in the stack.
</p>
<h2> <span class="mw-headline" id="LSP_dummy_entry"> LSP dummy entry </span></h2>
<p>Another mechanism to discuss up before we get to the fun part is the usage of LSP dummy entries. LSP is installed on top of multiple protocols, usually TCP and UDP; therefore, the installer creates a dummy entry with unique GUID different than that of the LSP. This entry is then named using the next layer’s name plus the LSP, separated by the “over” keyword. The name is created for easy understanding, and has no technical significance. (Note: some programmers do assign meaning to the dummy entry’s name, but this is wrong practice, as it is not defined as a crucial standard). A name can look like this:
</p>
<pre>
TestLSP over [MSAFD Tcpip [TCP/IP]]
</pre>
<p>This dummy entry is used to create a chain, and inside the chain’s entries it points to the actual
LSP. For example, let’s inspect this chain:
</p>
<pre>
LSP Installed under 2 GUIDs
        {D7E3B4EA-D34A-4FE7-BF66-02B5E0A38BBF}
        {4EEC5B94-2F44-4D3C-9AB1-9D13658880C8}
    Layer 1021 &quot;TestLSP over [MSAFD Tcpip [TCP/IP]]&quot;
        Chain 2 [ 1020 1001 ]
    Layer 1022 &quot;TestLSP over [MSAFD Tcpip [UDP/IP]]&quot;
        Chain 2 [ 1020 1002 ]
</pre>
<p>And the following layered LSP output (later in the manual we discuss how to get these lists):
</p>
<pre>
Winsock 32-bit Catalog:
=======================
1021 - TestLSP over [MSAFD Tcpip [TCP/IP]]
1022 - TestLSP over [MSAFD Tcpip [UDP/IP]]
1001 - MSAFD Tcpip [TCP/IP]
1002 - MSAFD Tcpip [UDP/IP]
1003 - MSAFD Tcpip [RAW/IP]
1020 – TestLSP
</pre>
<p>As the output shows, the LSP is installed using two GUIDs, one for each dummy entry (TCP and UDP), and each chain (bold and underlined) is composed of LSP ID 1020, which is our LSP, together with the relevant base provider ID. The ID for TCP is 1001 (the base provider for TCP, as seen in the list,) and the ID for UDP is 1002.
</p>
<h2> <span class="mw-headline" id="Autopilot"> Autopilot </span></h2>
<p>The autopilot is the most common usage of the installer when trying to actually install an LSP. It analyzes the stack and determines the best course of action on the fly.
</p>
<h3> <span class="mw-headline" id="Syntax"> Syntax </span></h3>
<p>Installation syntax for a Non-IFS LSP install:
</p>
<pre>
RegisterLSP –b –d LSPName
</pre>
<p>Installation syntax for an IFS LSP install:
</p>
<pre>
RegisterLSP –bi –d LSPName
</pre>
<p><b>Important:</b>
</p>
<ul><li> When RegisterLSP and the LSP are in the same directory, there is no need to specify the directory name.
</li><li> When the LSP path includes spaces, the path must be encapsulated in double quotes
</li><li> The installed LSP is copied to the System32 directory, so it’s okay to delete the original LSP file after installation.
</li></ul>
<h3> <span class="mw-headline" id="Practical_examples"> Practical examples </span></h3>
<p>Installing a Non-IFS LSP named nonifslsp.dll located at c:\lsp when the RegisterLSP is located
elsewhere:
</p>
<pre>
RegisterLSP –b –d c:\lsp\nonifslsp.dll
</pre>
<p>Installing a Non-IFS LSP named nonifslsp.dll located at “c:\test lsp” when the RegisterLSP is
located elsewhere:
</p>
<pre>
RegisterLSP –b –d “c:\test lsp\nonifslsp.dll”
</pre>
<p>Installing a Non-IFS LSP named nonifslsp.dll when the RegisterLSP is located in the same
directory as the LSP:
</p>
<pre>
RegisterLSP –b –d nonifslsp.dll
</pre>
<p>When installing an IFS LSP all the examples remain the same, but the flag –b is replaced with –bi
(and, of course, the LSP name should be ifslsp.dll). Thus, the first example would become:
</p>
<pre>
RegisterLSP –bi –d c:\lsp\ifslsp.dll
</pre>
<h3> <span class="mw-headline" id="Vista.2F7_permissions"> Vista/7 permissions </span></h3>
<p>Under Vista/7, the autopilot detects whether it’s running in UAC elevated mode or not. If it isn’t,
the installation process will stop with an error message saying it cannot install without UAC
privileges.
</p><p>UAC elevated mode is required for all install and update operations. The data collecting function
doesn’t require UAC elevated mode.
</p>
<h3> <span class="mw-headline" id="If_LSP_already_exists"> If LSP already exists </span></h3>
<p>When the LSP already exists (RegisterLSP detects a match based on the LSP GUID), the RegisterLSP compares the checksum of the source LSP with the checksum of the existing LSP. If the checksums are identical and the required installation strategy is the same, the RegisterLSP exists saying there is nothing to update.
</p><p>In case the files are different, it is an update install, and the RegisterLSP replaces the existing LSP with the source LSP. In case any temporary files are created, they are queued to be deleted after the next reboot (rebooting is not required for the install process).
</p><p>In case the existing installation strategy differs from the new required strategy, the installer updates the LSP installation to the new strategy and copies the source file to the System32 directory if necessary.
</p>
<h3> <span class="mw-headline" id="How_the_autopilot_works"> How the autopilot works </span></h3>
<p>Autopilot first analyzes the current stack condition and has a different strategy for each condition:
</p><p><i>No LSP installed:</i>
</p>
<ol><li> The installer copies the original LSP to System32
</li><li> The installer performs the LSP install
</li></ol>
<p><br />
<i>LSP installed is the same LSP we are trying to install:</i>
</p>
<ol><li> The installer checks if the source LSP and the existing LSP match:
<ol><li> If they do, the installer continues to do a strategy check.
</li><li> If they do not match, the installer replaces the existing LSP with the new one. Any temporary files created in the process are queued to be deleted after a reboot.
</li></ol>
</li><li> The installer checks if the existing installation strategy is the required strategy:
<ol><li> If they match, the installer exits.
</li><li> If they don’t match, the installer updates the existing strategy to match the new required strategy.
</li></ol>
</li></ol>
<p><br />
<i>The LSP we are trying to install doesn’t exist, but another LSP does exist:</i>
</p>
<ol><li> If the LSP we are trying to install is an IFS LSP, then it must be installed immediately after the base providers or after the last IFS LSP (experience shows that it is very difficult to stabilize a stack with more then two LSP installed)
</li><li> If the LSP we are trying to install is a Non-IFS LSP, then the installer tries to install it as follows:
<ol><li> The installer tries to install the new LSP to be first in the chain, which means that it processes every winsock command first (in manual installation, this is done by adding the –t flag. Refer to the Manual Installation section for more information). In case of failure to install (the installer tries to connect to the Internet,) the installer tries the next strategy.
</li><li> The installer tries to install the new LSP to be after the base provider, while keeping the existing installed LSP first in the chain (some LSPs require this due to architectural design or bad programming)
</li><li> There are rare LSPs that cannot have another LSP in the chain. In these cases, new LSPs must be installed over the base provider (this is called bypass mode), or the old “bad” LSP must be removed. Bypass mode is never chosen by the autopilot, but can only be preprogrammed using a scenario file.
</li></ol>
</li></ol>
<h2> <span class="mw-headline" id="Uninstalling_an_LSP"> Uninstalling an LSP </span></h2>
<h3> <span class="mw-headline" id="Uninstall_all_installed_LSPs"> Uninstall all installed LSPs </span></h3>
<p>Using the –f flag, the installer removes all user LSPs and leaves only base providers installed in
the stack:
</p>
<pre>
RegisterLSP –f
</pre>
<h3> <span class="mw-headline" id="Uninstalling_a_specific_LSP_using_its_ID"> Uninstalling a specific LSP using its ID </span></h3>
<p>Let us suppose that we have the following LSP stack:
</p>
<pre>
Winsock 32-bit Catalog:
=======================
1021 - TestLSP over [MSAFD Tcpip [TCP/IP]]
1022 - TestLSP over [MSAFD Tcpip [UDP/IP]]
1001 - MSAFD Tcpip [TCP/IP]
1002 - MSAFD Tcpip [UDP/IP]
1003 - MSAFD Tcpip [RAW/IP]
1004 - RSVP UDP Service Provider
1005 - RSVP TCP Service Provider
1012 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{0E41ADAF-748D-4FE4-A76F-F164642EEE87}] SEQPACKET 3
1013 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{0E41ADAF-748D-4FE4-A76F-F164642EEE87}] DATAGRAM 3
1014 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{B8E72AD6-0B84-4188-8841-52340436256E}] SEQPACKET 0
1015 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{B8E72AD6-0B84-4188-8841-52340436256E}] DATAGRAM 0
1016 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{A0299C89-898F-4CF1-BCDC-1EE2550DFC55}] SEQPACKET 1
1017 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{A0299C89-898F-4CF1-BCDC-1EE2550DFC55}] DATAGRAM 1
1018 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{9593A3E5-5C81-4534-9160-0D9376807B68}] SEQPACKET 2
1019 - MSAFD NetBIOS [\Device\NetBT_Tcpip_{9593A3E5-5C81-4534-9160-0D9376807B68}] DATAGRAM 2
1020 – TestLSP
</pre>
<p>We want to uninstall the LSP “TestLSP”. We do it using its ID, 1020:
</p>
<pre>
RegisterLSP –r 1020
</pre>
<h3> <span class="mw-headline" id="Uninstalling_a_specific_LSP_using_its_name"> Uninstalling a specific LSP using its name </span></h3>
<p>Using the stack from the previous example, in order to remove the LSP “TestLSP,” we use the following syntax:
</p>
<pre>
RegisterLSP –q TestLSP
</pre>
<p>In case the LSP name contains spaces, it must be encapsulated with double quotes. For an LSP named “My company LSP,” we would therefore use the following syntax:
</p>
<pre>
RegisterLSP –q “My company LSP”
</pre>
<h3> <span class="mw-headline" id="Disabling_file_removal_on_reboot"> Disabling file removal on reboot </span></h3>
<p>When uninstalling a specific LSP using –q or –r flags, the installer queues the file to be deleted from the System32 directory after the next reboot. To disable file deletion, the flag –s can be used, for example:
</p>
<pre>
RegisterLSP –q “My company LSP” –s
</pre>
<h2> <span class="mw-headline" id="Displaying_LSP_stack_information"> Displaying LSP stack information </span></h2>
<p>The structure of the stack is used to determine several important facts about the current stack
condition:
</p>
<ul><li> Which LSPs are installed and which are not.
</li><li> Is an installed LSP IFS or Non-IFS.
</li><li> The order of the LSPs inside a chain.
</li><li> How many chains exist.
</li></ul>
<h3> <span class="mw-headline" id="Basic_output"> Basic output </span></h3>
<p>The most basic way to view installed LSPs is:
</p>
<pre>
RegisterLSP –p
</pre>
<p>A sample output would look like the stack displayed in the section “Uninstalling a specific LSP
using its ID”, above.
</p><p>From this output we can extract:
</p>
<ul><li> A list of base providers and their IDs.
</li><li> A list of custom installed LSPs and their IDs.
</li><li> The location of the custom LSPs inside the chain.
</li></ul>
<h3> <span class="mw-headline" id="Chain_structure_output"> Chain structure output </span></h3>
<p>The installer enables you to view the chain structure which is part of all custom LSPs. The syntax
is:
</p>
<pre>
RegisterLSP –m
</pre>
<p>A sample output:
</p>
<pre>
32-bit Winsock LSP Map:

0 LSP: TestLSP DLL 'C:\WINDOWS\system32\nonifslsp.dll'ID: 1020

LSP Installed under 2 GUIDs
        {D7E3B4EA-D34A-4FE7-BF66-02B5E0A38BBF}
        {4EEC5B94-2F44-4D3C-9AB1-9D13658880C8}
    Layer 1021 &quot;TestLSP over [MSAFD Tcpip [TCP/IP]]&quot;
        Chain 2 [ 1020 1001 ]
    Layer 1022 &quot;TestLSP over [MSAFD Tcpip [UDP/IP]]&quot;
    Chain 2 [ 1020 1002 ]

    Dependent LSPs:
        None
</pre>
<p>What we see here is a single LSP installed with two chains, each composed from that LSP’s
dummy entry and the base provider.
</p>
<h3> <span class="mw-headline" id="Displaying_layered_LSPs_only"> Displaying layered LSPs only </span></h3>
<p>To display only the layered LSPs without the base providers and dummy entries, use the
following syntax:
</p>
<pre>
RegisterLSP –l
</pre>
<p>A sample output:
</p>
<pre>
Winsock 32-bit Catalog:
=======================
1020 – TestLSP
</pre>
<h3> <span class="mw-headline" id="Verbose_display"> Verbose display </span></h3>
<p>During installation, every installer defines a number of states that affect the LSP during runtime, (e.g., whether the LSP uses an IFS or a non-IFS handle.) Verbose display outputs a list of these predefined states. It is used mostly to debug installation problems. This option can be used in conjunction with two flags:
</p>
<pre>
RegisterLSP –l –v
RegisterLSP –p –v
</pre>
<p>A sample output:
</p>
<pre>
Winsock 32-bit Catalog:
=======================
Protocol: TestLSP
    Path: C:\WINDOWS\system32\pcproxy.dll
           Address Family: AF_INET
                 Protocol: IPROTO_IP
              Socket Type:            Connectionless: NO
      Guaranteed Delivery: YES
         Guaranteed Order: YES
         Message Oriented: NO
            Pseudo Stream: NO
           Graceful Close: YES
           Expedited Data: YES
             Connect Data: NO
          Disconnect Data: NO
       Supports Broadcast: NO
      Supports Multipoint: NO
 Multipoint Control Plane: NON-ROOTED
    Multipoint Data Plane: NON-ROOTED
            QoS Supported: NO
     Unidirectional Sends: NO
    Unidirection Receives: NO
              IFS Handles: NO
         Partial Messages: NO
           Provider Flags: PFL_HIDDEN 
              Provider Id: {27CED56E-77D2-4B96-906F-BA4087AE01C4}
         Catalog Entry Id: 1014
  Number of Chain Entries: 0   {}
                  Version: 2
Max Socket Address Length: 16
Min Socket Address Length: 16
      Protocol Max Offset: 0
       Network Byte Order: BIG-ENDIAN
          Security Scheme: NONE
             Message Size: N/A (Stream Oriented)
        Provider Reserved: 0
</pre>
<p><b>Important note:</b> this is only for the LSP entry and not for the dummy entries. The interpretation
of this output is beyond the scope of this manual.
</p>
<h3> <span class="mw-headline" id="How_to_build_a_scenario_file"> How to build a scenario file </span></h3>
<p>Scenario files are used with autopilot only; they have no effect on manual installs.
</p>
<h4> <span class="mw-headline" id="Why_use_a_scenario_file.3F"> Why use a scenario file? </span></h4>
<p>Scenario files are used when there is a known LSP for which the autopilot cannot detect the correct strategy, or when we choose to bypass this LSP even though it’s possible to install our LSP in the same chain.
</p><p>Note: bypassing an LSP when you don’t have to do so is considered bad practice.
</p>
<h4> <span class="mw-headline" id="Using_the_scenario_file"> Using the scenario file </span></h4>
<p>The scenario file is named RegisterLSP.ini and should be located in the same directory as the installer. The file format is simple: it is the name of the LSP followed by the installation strategy, separated by a comma. The installation strategies are:
</p>
<ul><li> Bypass – install the LSP directly after the base providers and bypass the existing installed LSP.
</li><li> Before – install the LSP to be first in chain, and all winsock commands will go through this LSP first.
</li><li> After – install the LSP last in the chain and the closest to the base providers.
</li></ul>
<p>Sample file structure:
</p>
<pre>
ProductLSP,before
CompanyLSP,after
SomeLSP,bypass
</pre>
<h2> <span class="mw-headline" id="Sanity_checks_and_backup_operations"> Sanity checks and backup operations </span></h2>
<p>Before installing an LSP, it is important to ensure that the stack is in perfect state; otherwise, if the computer network is already corrupt, the user might wrongly blame the last installed LSP.
</p>
<h3> <span class="mw-headline" id="Checking_winsock_integrity"> Checking winsock integrity </span></h3>
<p>When the stack is completely corrupted, it is impossible to initialize winsock. The installer can check for this condition and warn about it:
</p>
<pre>
RegisterLSP –tw
</pre>
<p>If everything is okay, the installer will return 0 as error code. All other values denote stack corruption, and install should be halted immediately. Any installation after this kind of corruption is at your own risk.
</p>
<h3> <span class="mw-headline" id="Checking_LSP_chain_integrity"> Checking LSP chain integrity </span></h3>
<p>Another type of corruption is when there is a legitimate stack but one of the LSP files is missing, resulting in lack of networking. To detect this, use:
</p>
<pre>
RegisterLSP –tc
</pre>
<p>The installer will load and perform integrity tests on all the LSPs referenced by the stack. It will:
</p>
<ul><li> Detect if the file exists.
</li><li> Try to load the file as DLL.
</li><li> Try to get the GUID from the LSP.
</li></ul>
<p>If any of the tests fails, the installer warns about it by exiting with an error code other then zero,
and as mentioned above, continuing to install at this point is at your own risk.
</p><p>A sample output:
</p>
<pre>
Testing winsock chain
Trying to load provider: TestLSP over [MSAFD Tcpip [TCP/IP]], file name: C:\WINDOWS\system32\pcproxy.dll, result - Success
Trying to load provider: TestLSP over [MSAFD Tcpip [UDP/IP]], file name: C:\WINDOWS\system32\pcproxy.dll, result - Success
Trying to load provider: MSAFD Tcpip [TCP/IP], file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD Tcpip [UDP/IP], file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD Tcpip [RAW/IP], file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: RSVP UDP Service Provider, file name: C:\WINDOWS\system32\rsvpsp.dll, result - Success
Trying to load provider: RSVP TCP Service Provider, file name: C:\WINDOWS\system32\rsvpsp.dll, result - Success
Trying to load provider: MSAFD NetBIOS [\Device\NetBT_Tcpip_{5944002C-C2A2-4A21-B811-1792B5F2B28D}] SEQPACKET 0, file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD NetBIOS [\Device\NetBT_Tcpip_{5944002C-C2A2-4A21-B811-1792B5F2B28D}] DATAGRAM 0, file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD NetBIOS [\Device\NetBT_Tcpip_{850C34EA-343D-4FE7-A8BE-8FFE8CCB10BB}] SEQPACKET 1, file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD NetBIOS [\Device\NetBT_Tcpip_{850C34EA-343D-4FE7-A8BE-8FFE8CCB10BB}] DATAGRAM 1, file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD NetBIOS [\Device\NetBT_Tcpip_{D9FF0E6E-8144-409D-A99D-8D0B7345CAF5}] SEQPACKET 2, file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: MSAFD NetBIOS [\Device\NetBT_Tcpip_{D9FF0E6E-8144-409D-A99D-8D0B7345CAF5}] DATAGRAM 2, file name: C:\WINDOWS\system32\mswsock.dll, result - Success
Trying to load provider: VMCI sockets DGRAM, file name: C:\Program Files\VMware\VMware Tools\VSock SDK\bin\win32\vsocklib.dll, result - Success
Trying to load provider: VMCI sockets STREAM, file name: C:\Program Files\VMware\VMware Tools\VSock SDK\bin\win32\vsocklib.dll, result - Success
Trying to load provider: TestLSP, file name: C:\WINDOWS\system32\pcproxy.dll, result - Success


Exiting with error code: 0 which means everything went OK
</pre>
<h3> <span class="mw-headline" id="Backing_up_the_winsock_stack"> Backing up the winsock stack </span></h3>
<p>The installer has the ability to backup the stack using the following syntax:
</p>
<pre>
RegisterLSP –br FileName
</pre>
<p>For example:
</p>
<pre>
RegisterLSP –br c:\backup.dat
</pre>
<h3> <span class="mw-headline" id="Restoring_the_winsock_stack"> Restoring the winsock stack </span></h3>
<p>An important point to understand is that the winsock is restored to its exact state from the time it was backed up, meaning that if after the backup operation some LSPs were uninstalled and files were removed, the restored state may be corrupted. The syntax is:
</p>
<pre>
RegisterLSP –rr FileName
</pre>
<p>Restoring the stack using the file in the above example would look like this:
</p>
<pre>
RegisterLSP –rr c:\backup.dat
</pre>
<h2> <span class="mw-headline" id="Manual_installation"> Manual installation </span></h2>
<p>Sometimes manual installation is required, usually for testing purposes. All the features of the autopilot can be used manually. This is possible as long as the proper IDs or names of the LSPs we wish to layer over are known.
</p><p>The manual installation has two important flags that repeat in all manual installations: -i and –d (which denotes the LSP name and path).
</p>
<h3> <span class="mw-headline" id="Installing_over_other_providers_based_on_their_IDs"> Installing over other providers based on their IDs </span></h3>
<p>To install an LSP over TCP and UDP, use the following syntax:
</p>
<pre>
RegisterLSP –i –o TCPID –o UDPID –d LSPName
</pre>
<p>We assume that the ID for TCP is 1001 and for UDP is 1002, as seen in the printouts in this manual. Keep in mind, however, that on some computers these IDs do not match: make sure you know the proper IDs before using them in a manual install. A typical manual install would look like this:
</p>
<pre>
RegisterLSP –i –o 1001 –o 1002 –d “c:\MyLsp.dll”
</pre>
<h3> <span class="mw-headline" id="Installing_an_IFS_LSP"> Installing an IFS LSP </span></h3>
<p>If we install an IFS LSP, we must tell installer about it. We do so by using the flag –h. Installing an IFS LSP over TCP and UDP would look like this:
</p>
<pre>
RegisterLSP –i –h –o 1001 –o 1002 –d “c:\MyLsp.dll”
</pre>
<h3> <span class="mw-headline" id="Installing_over_other_providers_based_on_their_names"> Installing over other providers based on their names </span></h3>
<p>As stated previously, using the ID is possible only when the person installing is using the target machine and knows the precise ID. That is why it is better to install the LSP using the layer name rather then the ID. This is done by using the –z flag instead of –o  (when using IDs). Installing over TCP and UDP would look like this:
</p>
<pre>
RegisterLSP –i –z “MSAFD Tcpip [TCP/IP]” –z “MSAFD Tcpip [UDP/IP]” –d “c:\MyLsp.dll”
</pre>
<h3> <span class="mw-headline" id="Installing_over_another_LSP_based_on_either_its_name_or_its_ID"> Installing over another LSP based on either its name or its ID </span></h3>
<p>This is done exactly the same as with a base provider, the only difference being the name or ID of the LSP we wish to layer on. Suppose we have the following stack:
</p>
<pre>
Winsock 32-bit Catalog:
=======================
1021 - TestLSP over [MSAFD Tcpip [TCP/IP]]
1022 - TestLSP over [MSAFD Tcpip [UDP/IP]]
1001 - MSAFD Tcpip [TCP/IP]
1002 - MSAFD Tcpip [UDP/IP]
1003 - MSAFD Tcpip [RAW/IP]
1020 – TestLSP
</pre>
<p>And we wish to layer over TestLSP. This is how we do it using an ID:
</p>
<pre>
RegisterLSP –i –o 1021 –o 1022 –d “c:\MyLsp.dll”
</pre>
<p>This is how we do it using the name:
</p>
<pre>
RegisterLSP –i –z “TestLSP over [MSAFD Tcpip [TCP/IP]]” –z “TestLSP over [MSAFD Tcpip [UDP/IP]]” –d “c:\MyLsp.dll”
</pre>
<p>The only difference here from the previous examples is the different name or ID.
</p>
<h3> <span class="mw-headline" id="Installing_over_an_existing_chain"> Installing over an existing chain </span></h3>
<p>The previous example has revealed that we must know the LSP’s exact name or IDs if we want to layer over it; but unless we without executing “RegisterLSP –p” we cannot know this information in advance. To overcome this problem, it is possible to instruct the installer to locate the LSP installed over TCP and UDP, and use its chain for the install process.
</p>
<h4> <span class="mw-headline" id="Installing_LSP_first_in_the_chain"> Installing LSP first in the chain </span></h4>
<p>If we want our LSP to be first in the chain, we can use the –t flag. The following example shows how to do it layering over both TCP and UDP:
</p>
<pre>
RegisterLSP –i –t –o 1001 –o 1002 –d “c:\MyLsp.dll”
</pre>
<p>This example uses the TCP’s and UDP’s explicit names:
</p>
<pre>
RegisterLSP –i –t –z “MSAFD Tcpip [TCP/IP]” –z “MSAFD Tcpip [UDP/IP]” –d “c:\MyLsp.dll”
</pre>
<h4> <span class="mw-headline" id="Installing_LSP_last_in_the_chain"> Installing LSP last in the chain </span></h4>
<p>We may want our LSP to be last in the chain, and closest to the base providers. For this we use the –j flag instead of the –t flag used in the previous example. This is how we do it using TCP/UDP IDs:
</p>
<pre>
RegisterLSP –i –j –o 1001 –o 1002 –d “c:\MyLsp.dll”
</pre>
<p>This example uses the TCP’s and UDP’s explicit names:
</p>
<pre>
RegisterLSP –i –j –z “MSAFD Tcpip [TCP/IP]” –z “MSAFD Tcpip [UDP/IP]” –d “c:\MyLsp.dll”
</pre>
<h2> <span class="mw-headline" id="64Bit"> 64Bit </span></h2>
<p>An LSP compiled using 32bit can work in 32bit and 64bit environments, but an LSP compiled using 64bit can only work in a 64bit environment. Furthermore, a 32bit installer can install only 32bit LSPs, but a 64bit installer (which can operate only under a 64bit environment) can install both 32bit and 64bit LSPs.
</p><p>We separated the advanced installer to 32bit and 64bit, which means that each command you run you need to run twice under 64bit OS: Once for 32bit and once for 64bit.
</p>
<h2> <span class="mw-headline" id="Working_with_the_DLL_installer"> Working with the DLL installer </span></h2>
<h3> <span class="mw-headline" id="When_to_use_the_DLL_installer"> When to use the DLL installer </span></h3>
<ul><li> Under Vista, the DLL has the privileges of its spawning process, which means that if the caller is running with UAC elevated mode, there is no need to get another elevation for the installer.
</li><li> The installer has the ability to retrieve the list of installed LSPs inside an array, so it can be further inspected. (This can also be done with the normal installer; however, it requires further parsing by the user).
</li></ul>
<h3> <span class="mw-headline" id="Linking_with_the_DLL"> Linking with the DLL </span></h3>
<p>This can be done either by linking with the static library or using the LoadModule API command. The installer comes with a sample that shows how to link with the static library.
</p>
<h3> <span class="mw-headline" id="Installer_API"> Installer API </span></h3>
<p>Working with the DLL installer is almost the same as working with the command line installer. Programmatically, it accepts the same parameters and performs the same as the command line installer.
</p>
<h4> <span class="mw-headline" id="AddParam.2C_Execute.2C_ResetParam"> AddParam, Execute, ResetParam </span></h4>
<p>AddParam is used to add a single parameter to the installer; Execute is used to actually perform the command. ResetParam is used if there is no need to perform another call to the installer, and removes all the parameters added by previous call to AddParam. The following sample runs an autopilot install of an LSP, and then removes all installed LSPs:
</p>
<pre>
//The following code is equivalent to: RegisterLSP –b –d c:\nonifslsp.dll
AddParam(“-b”);
AddParam(“-d”);
AddParam(“c:\\nonifslsp.dll”);
Execute();

//Need to delete the previous parameters
ResetParam();

//Now perform the remove
AddParam(“-f”);
Execute();
</pre>
<h3> <span class="mw-headline" id="Subverting_output"> Subverting output </span></h3>
<p>The installer in DLL mode doesn’t output to the screen like the command line installer, so there are functions that send the output into a buffer.
</p>
<h4> <span class="mw-headline" id="GetOutputDataSize"> GetOutputDataSize </span></h4>
<p>Returns the number of bytes required to get the output buffer.
</p>
<h4> <span class="mw-headline" id="GetOutputData"> GetOutputData </span></h4>
<p>Gets the actual data from the buffer. If successful, the return value is the buffer size. If the buffer is too small, the return value will be –1. After successful retrieval of the data, the output is erased. A sample usage:
</p>
<pre>
    //First get the size needed
    int iSize=GetOutputDataSize();

    //Do we have data?
    If (iSize)
    {
        //Allocate a buffer to accommodate
        char* pData;
        pData=new char[iSize];

        //And get the data
        if (GetOutputData(pData,
                          iSize)&gt;0)
            //Show it, or do some other stuff
            printf(“%s\n”,pData);

        //Cleanup
        delete [] pData;
    }
</pre>
<h3> <span class="mw-headline" id="Vista_API"> Vista API </span></h3>
<p>There are two methods that help working with Vista.
</p>
<h4> <span class="mw-headline" id="IsVista"> IsVista </span></h4>
<p>Returns true if the OS is Vista.
</p>
<h4> <span class="mw-headline" id="IsElevated"> IsElevated </span></h4>
<p>Returns true if UAC is elevated. If the OS is not Vista, the return value will always be true. All install/uninstall operations on Vista require UAC elevation, without which the install/uninstall will fail.
</p><p>Sample code:
</p>
<pre>
//Are we inside Vista?
if (IsVista())
    //Are we elevated?
    if (!IsElevated())
        //Do something about it
        printf(“Vista UAC not elevated!”);
</pre>
<h3> <span class="mw-headline" id="Getting_the_installed_LSP_list"> Getting the installed LSP list </span></h3>
<p>It is possible to perform a –p command and parse the output. However, there is an easier method for retrieving the data already parsed.
</p>
<h4> <span class="mw-headline" id="GetInstalledLSPs"> GetInstalledLSPs </span></h4>
<p>Expects a pointer large enough in size to contain all the LSPs inside the stack. The data is sorted by LSP ID.
</p><p>Sample code:
</p>
<pre>
//Allocate big enough variable, never seen a system with 100 LSPs!
char* pData;
pData=new char[100*sizeof(InstalledLSP)];

//Perform the call
int iLSPs=GetInstalledLSPs(pData,100*sizeof(InstalledLSP));

//Did we get it?
if (iLSPs&gt;0)
    //Do something, e.g., print it
    for (int iCounter=0;
         iCounter&lt;iLSPs/sizeof(InstalledLSP);
         iCounter++)
        printf(“%i -&#160;%s\n”,pData[iCounter].dwID,
                           pData[iCounter].aName);

//Cleanup
delete [] pData;
</pre>
<h2> <span class="mw-headline" id="Working_with_the_COM_installer"> Working with the COM installer </span></h2>
<p>The COM installer is a COM DLL that can be used from every COM-capable application: VC, VB, .Net, etc.
</p><p>It exposes the same API functionalities as does the DLL installer. The only difference is with the parameters and return value type, which are variant compliant to adhere to the COM standards.
</p>
<h3> <span class="mw-headline" id="Registering_the_DLL"> Registering the DLL </span></h3>
<p>Since the DLL is COM based, it must be registered as such. To do so, run the following command inside the DLL’s directory:
</p>
<pre>
Regsvr32 RegisterLSPCOM.dll
</pre>

<!-- 
NewPP limit report
Preprocessor visited node count: 779/1000000
Preprocessor generated node count: 0/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key komod_wikidb:pcache:idhash:37-0!*!0!!en!*!* and timestamp 20150219012354 -->
</div><div class="printfooter">
Retrieved from "<a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;oldid=540.html">http://www.komodia.com/wiki/index.php?title=Komodia%27s_Advanced_LSP_Installer&amp;oldid=540</a>"</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="index.php/Komodia's_Advanced_LSP_Installer.html" primary="1" context="subject" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.komodia.com/wiki/index.php?title=Talk:Komodia%27s_Advanced_LSP_Installer&amp;action=edit&amp;redlink=1" primary="1" context="talk" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;action=edit.html" primary="1" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;action=history.html" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://www.komodia.com/wiki/index.php/User:46.165.222.245" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">46.165.222.245</a></li>
				<li id="pt-anontalk"><a href="http://www.komodia.com/wiki/index.php/User_talk:46.165.222.245" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
				<li id="pt-anonlogin"><a href="index.php@title=Special%253AUserLogin&amp;returnto=Komodia%2527s+Advanced+LSP+Installer&amp;returntoquery=printable%253Dyes.html" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
<a href="index.php/Main_Page.html" style="background-image: url(http://www.komodia.com/images/logo.png);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.php/Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-Official-homepage"><a href="../index.php.html">Official homepage</a></li>
				<li id="n-recentchanges"><a href="index.php/Special%253ARecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://www.komodia.com/wiki/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" title="Search Komodia [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="index.php/Special%253AWhatLinksHere/Komodia's_Advanced_LSP_Installer.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="index.php/Special%253ARecentChangesLinked/Komodia's_Advanced_LSP_Installer.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="index.php/Special%253ASpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
				<li id="t-permalink"><a href="index.php@title=Komodia%2527s_Advanced_LSP_Installer&amp;oldid=540.html" title="Permanent link to this revision of the page">Permanent link</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="lastmod"> This page was last modified on 20 March 2011, at 14:48.</li>
		<li id="viewcount">This page has been accessed 10,351 times.</li>
		<li id="privacy"><a href="index.php/Komodia%253APrivacy_policy.html" title="Komodia:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="index.php/Komodia%253AAbout.html" title="Komodia:About">About Komodia</a></li>
		<li id="disclaimer"><a href="index.php/Komodia%253AGeneral_disclaimer.html" title="Komodia:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-6898822-1");
pageTracker._trackPageview();
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.komodia.com/" : "http://piwik.komodia.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 6);
piwikTracker.setDocumentTitle("");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://piwik.komodia.com/piwik.php?idsite=6" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.187 secs. --></body></html>