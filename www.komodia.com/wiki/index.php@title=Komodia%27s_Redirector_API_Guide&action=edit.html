<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>View source for Komodia's Redirector API Guide - Komodia</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.20.4" />
<link rel="next" href="index.php/Komodia's_Redirector_API_Guide.html" />
<link rel="shortcut icon" href="../favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Komodia (en)" />
<link rel="EditURI" type="application/rsd+xml" href="api.php@action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Komodia Atom feed" href="index.php@title=Special%253ARecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php@debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;%252A.css" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: komod_wikidb:resourceloader:filter:minify-css:7:dffa96a73b1be9b0dae7e17005fcc939 */</style>

<script src="load.php@debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;%252A"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Komodia\'s_Redirector_API_Guide","wgTitle":"Komodia\'s Redirector API Guide","wgCurRevisionId":1439,"wgArticleId":40,"wgIsArticle":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Komodia\'s_Redirector_API_Guide","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: komod_wikidb:resourceloader:filter:minify-js:7:c89fc005766e312c555f83b307d08d63 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Komodia_s_Redirector_API_Guide skin-monobook action-edit">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading"><span dir="auto">View source for Komodia's Redirector API Guide</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From Komodia</div>
		<div id="contentSub">‚Üê <a href="index.php/Komodia's_Redirector_API_Guide.html" title="Komodia's Redirector API Guide">Komodia's Redirector API Guide</a></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="index.php@title=Komodia%2527s_Redirector_API_Guide&amp;action=edit.html#column-one">navigation</a>, <a href="index.php@title=Komodia%2527s_Redirector_API_Guide&amp;action=edit.html#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://www.komodia.com/wiki/index.php?title=Komodia:Users&amp;action=edit&amp;redlink=1" class="new" title="Komodia:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">This page covers [[Komodia's Redirector]] API, this page should be read only after you worked with the Redirector and know how to control it, you can learn more on how to control the Redirector here [[Komodia's Redirector installation guide]].

This page also covers the samples that are provided with the Redirector.

= When to use =

The API is used to control all the aspects of the [[Komodia's Redirector]] which you are currently doing using the PCController.exe

When deploying the SDK you can :

# Use the API (which is detailed below) or
# In case your settings are constant, you can set it up once and distribute the INI file with the settings when you install your product (more on the INI files and locations: [[Komodia's Redirector installation guide#Settings_load_sequence]]).

= Samples =

You can download the samples for: C++, VB6, VB.net,C# from  [http://www.komodia.com/RedirectorAPI.zip Redirector API samples]

'''Important''' these samples are for the trial version, if you are an existing client you should download the samples from the link provided for you by Komodia after the purchase.

== VB6 ==

You will find the VB6 project inside the directory VB6, it's the console we give away with the trials to control the Redirector, it can be quite complex so we recommend to read how the API work or view the VB.Net sample which is more specific.

== VB.Net ==

You will find the VB.Net sample inside the directory C#, this is a small sample that just connects to the Redirector and set the DLL framework. This sample is only a base, you can use the C# code to extend it.

=== Redirector ===

This is the main Redirector control sample, inside there are number of methods to control the Redirector:

* Clear - Clears the redirector data.
* Load - Loads the data from file.
* Save - Saves the data to a file.
* Add ports - Adds ports to the interception list, this can also be used to add applications or IPs, just change the line:

&lt;pre>
tbl = dc.GetTable(PCProxyLib._Tables.dtPort)
&lt;/pre>

To:

&lt;pre>
tbl = dc.GetTable(PCProxyLib._Tables.dtApplications)
&lt;/pre>

* Set proxy - Sets a proxy to redirect intercepted traffic to.
* Clear proxy - Clear the proxy settings.
* Save custom data - Shows the user how to save custom data to the Redirector data storage.
* GetCustomData (Internal function) - Shows how to retrieve the custom data.
* Connect SSH - Shows how to open a SSH channel ([[Komodia's Redirector SSH component]] is an optional component which is needed to be requested during the trial)
* Kill SSH - Closes the SSH channel.
* Set DLL - Shows how to set a custom DLL.

=== Watchdog ===

This is the sample to control the [[Komodia's Watchdog]] (This is an optional module)

=== Traffic handling samples ===

This samples shows how to use the [[Komodia's Redirector COM framework guide]].

== C# ==

You will find the VB.Net sample inside the directory C#, this is a small sample that just connects to the Redirector and set the DLL framework. This sample is only a base, you can use the VB.Net code to extend it.

=== Redirector ===

This is the main Redirector control sample, inside there are number of methods to control the Redirector:

* Clear - Clears the redirector data.
* Load - Loads the data from file.
* Save - Saves the data to a file.
* Add ports - Adds ports to the interception list, this can also be used to add applications or IPs, just change the line:

&lt;pre>
tbl = dc.GetTable(PCProxyLib._Tables.dtPort)
&lt;/pre>

To:

&lt;pre>
tbl = dc.GetTable(PCProxyLib._Tables.dtApplications)
&lt;/pre>

* Set proxy - Sets a proxy to redirect intercepted traffic to.
* Clear proxy - Clear the proxy settings.
* Save custom data - Shows the user how to save custom data to the Redirector data storage.
* GetCustomData (Internal function) - Shows how to retrieve the custom data.
* Connect SSH - Shows how to open a SSH channel ([[Komodia's Redirector SSH component]] is an optional component which is needed to be requested during the trial)
* Kill SSH - Closes the SSH channel.
* Set DLL - Shows how to set a custom DLL.

=== Watchdog ===

This is the sample to control the [[Komodia's Watchdog]] (This is an optional module)

=== Traffic handling samples ===

This samples shows how to use the [[Komodia's Redirector COM framework guide]].

== C++ ==

The C++ sample contains two folders: one for direct usage of the code (you embedd the class) and one to use via a DLL.

=== CRedirectorControl class ===

This is the main class used to control the Redirector with direct and DLL method, this is the header:

&lt;pre>
class CRedirectorControl  
{
public:
	//Set a flag
	static std::wstring SetFlag(const std::wstring&amp; rFlagName,
				    const std::wstring&amp; rParameter);

	//Get the flag
	static std::wstring GetFlag(const std::wstring&amp; rFlagName,
				    std::wstring&amp; rParameter);

	//Set the redirector status
	static std::wstring SetRedirectorEnabled(bool bEnabled);

	//Is the redirector enabled
	static std::wstring IsRedirectorEnabled(bool&amp; rEnabled);

	//Clear the proxy
	static std::wstring ClearProxyInformation();

	//Get the proxy from the redirector
	static std::wstring GetProxyInformation(std::string&amp; rIP,
						unsigned short&amp; rPort,
						std::string&amp; rUsername,
						std::string&amp; rPassword,
						_RD_ProxyType&amp; rType);

	//Set the proxy for the redirector
	static std::wstring SetProxyInformation(const std::string&amp; rIP,
						unsigned short usPort,
						const std::string&amp; rUsername,
						const std::string&amp; rPassword,
						_RD_ProxyType aType);

	//Delete an item
	static std::wstring DeleteItem(_RD_ItemType aItem,
				       const std::wstring&amp; rItem);

	//Get an item
	static std::wstring GetItems(_RD_ItemType aItem);

	//Add an item
	static std::wstring AddItem(_RD_ItemType aItem,
				    const std::wstring&amp; rItem);

	//Do a clear/load/save
	static std::wstring TakeAction(_RD_ActionType aType);

	//Ctor and Dtor
	CRedirectorControl();
	virtual ~CRedirectorControl();
};
&lt;/pre>

The return value of each function is string which denotes if the operation was successful or not:

Success - The string will be empty.

Error - The string will contain the error.

==== SetFlag ====

This method sets a flag:

rFlagName - Flag name (flag list will be later in this page)

rParameter - Value to Set.

==== GetFlag ====

This method gets the value of a flag:

rFlagName - Flag name.

rParameter - Will contain the value of the flag, if the flag doesn't exists this parameter will remain empty.

==== SetRedirectorEnabled ====

This method enable or disable the redirector: (to learn more about disable/enable goto: [[Komodia's Redirector installation guide#Enable.2Fdisable]].

bEnabled - True for enable, False for disable.

==== IsRedirectorEnabled ====

This method queries the state of the Redirector:

rEnabled - Will contain the value denoting if the Redirector is enabled or disabled.

==== Proxy control ====

You can learn more about proxies here: [[Komodia's Redirector installation guide#Proxy_control]].

Proxy type is chosen with this enum:

&lt;pre>
typedef enum _RD_ProxyType
{
	ptHTTP,
	ptHTTPConnect,
	ptHTTPConnectSSL,
	ptHTTPHybrid,
	ptHTTPHybridSSL,
	ptSocks4,
	ptSocks5,
	ptNone
} RD_ProxyType;
&lt;/pre>

===== ClearProxyInformation =====

This method will clear proxy information.

===== GetProxyInformation =====

This method will retreive the current proxy settings:

rIP - Will contain the IP of the proxy.

rPort - Will contain the port of the proxy.

rUsername - Will contain the username of the proxy.

rPassword- Will contain the password of the proxy.

rType- Will contain the type of the proxy.

===== SetProxyInformation =====

This method will set the proxy settings:

rIP - IP of the proxy.

rPort - Port of the proxy.

rUsername - Username of the proxy.

rPassword- Password of the proxy.

rType- Type of the proxy.

==== Items ====

Item control are used to add, get and remove Applications, ports and IPs. The type is controlled via this enum:

&lt;pre>
typedef enum _RD_ItemType
{
    itApplication,
    itApplicationInv,
    itPort,
    itPortInv,
    itIP,
    itIPInv,
    itHardExclude = 9,
    itHardInclude,
    itApplicationUDP,
    itPortUDP,
    itIPUDP,
    itApplicationInvUDP,
    itPortInvUDP,
    itIPInvUDP,
    itApplicationTCPI,
    itPortTCPI,
    itIPTCPI,
    itApplicationInvTCPI,
    itPortInvTCPI,
    itIPInvTCPI
} RD_ItemType;&lt;/pre>

*The members with the "Inv" at the end denote the list to never intercept (right pane in the PCController when trying to set the interception rules: [[Komodia's Redirector installation guide#Rules_type]].
* Members that end with UDP are for the UDP interception module.
* Members that end with TCPI are for the incoming TCP interception module.

All the methods are case insensitive.

===== DeleteItem =====

This method deletes an item from the list:

aItem - Item type.

rItem - Item to delete.

===== AddItem =====

This method adds an item to the list:

aItem - Item type.

rItem - Item to delete.

===== GetItems =====

This method will get all the items inside one of the lists, the data will be delimited by a comma (,):

aItem - Item type.

Return value - The delimited string.

==== TakeAction ====

This method clears, saves and loads data according to this enum:

&lt;pre>
typedef enum _RD_ActionType
{
	atSave,
	atLoad,
	atClear
} RD_ActionType;
&lt;/pre>

aType - Action type.

=== Direct ===

The direct samples is using the class directly to control the Redirector, please note that you must initialize COM in the thread that you are using to control the Redirector.

==== API ====

This sample shows how to set an application to intercept, save and clear the data.

==== Header and cookies ====

This sample shows how to set the headers filtering mechanism and regex cookie processing.

==== Proxy ====

This samples shows how to set a proxy.

==== Traffic handling samples ====

This samples shows how to use the [[Komodia's Redirector COM framework guide]].

==== Ad inject with HTTP Parser ====

This sample shows how to inject an item into a HTML page using the HTTP Parser.

==== Ad inject with ad injector ====

This sample shows how to inject an item into a HTML page using the HTTP Parser and ad injector, it will be a little bit faster and a little bit more complex.

==== Ad injection (using service instead of console) ====

Service that does ad injection (based on the Ad inject with ad injector sample).

===== Compiling =====

* The main project is InjectorServiceExe
* The define INJECTION_STRING under KomodiaInject.h sets the data to inject.
* The define INJECTION_DOMAIN under KomodiaInject.h sets the domain to inject to.
* The optional define INJECTION_FILE under KomodiaInject.h sets the file name to be read, the file will be loaded from the path of the service, and each line will contain a domain.

===== Installing =====

From UAC enabled command prompt (on Windows Vista and above) run:

&lt;pre>
InjectorServiceExe install auto
sc start InjectorService
&lt;/pre>

It will be running after a reboot since it's installed as automatic start.

===== Uninstalling =====

From UAC enabled command prompt (on Windows Vista and above) run:

&lt;pre>
sc stop InjectorService
InjectorServiceExe uninstall
&lt;/pre>

=== DLL ===

The DLL control is good if you plan to use it from a non C++ language, but does supports DLLs (such as Delphi, although it's possible to use COM directly from Delphi)

==== RedirectorControlDLL ====

Is the project to compile the DLL.

==== TestControlDLL ====

Is the sample of how to interface with the DLL.

== LSP Installer DLL Control ==

This sample is given only after purchase of the SDK and it contains code to install/uninstall the LSP and service. It also shows to get list of all installed LSPs.

= Starting and shutting down the service =

== Service start ==

When starting the service it's important to wait until it's in started mode before making any COM calls.

== Using SCM ==

The service can be stopped and started via the service control manager, or via the SCM WinAPI, in order to do so the controlling application must have administrative privileges.

== Using COM ==

When using the COM the controlling application doesn't have to have administrating privileges.

=== Shutting down ===

To shut down the proxy you can call the COM method StopProcess

&lt;pre>
dim dt as new DataController
dt.StopProcess
&lt;/pre>

=== Starting up ===

Any COM call will start the service, you need to make sure that you wait until the service is in started state before making any further COM calls, also the COM call that brings up the service may fail due to timeout, so make sure you capture and ignore any error you encounter

&lt;pre>
dim dt as new DataController

'Bring up the service
dim tb as DataTable
set tb=dt.GetTable(dtApplications)

'Here will be code that waits until the service is in started mode using the SCM WinAPI

&lt;/pre>

= API =

The API is built somewhat like a database, it has tables and containers (which can be regarded to as tables inside tables) which allows the user to set and receive information.

== DataTable ==

This class represents a table inside the Redirector, it's where all the data is stored.

The class has several important methods to work with data:

=== Bulk methods ===

The data structure of bulk data is:

* For single data table (like Applications, ports, IPs) it will look like this: iexplore.exe, firefox.exe
* For double data tables (like flags which consists of index and data) it will look like this: flagname, flagvalue

==== BulkAdd ====

This methods add data in bulk from the table.

bData - The data to add delimited by comma.

==== BulkGet ====

This methods gets data in bulk to the table.

bData - The bulk data received.

==== BulkErase====

This methods erases data in bulk from the table.

bData - The bulk data to be erased.

=== AddString ===

This method will add a string to the table, you can add a number as a string, at the end all data is stored as strings.

bString - String to add.

=== AddLong ===

This method will add a number to the table.

lData - Number to add.

=== AddStringIdx ===

This method will add a string to the table that is build with index and data (like the flags table):

bIndex - Index of the data.
bStr - String of the data.

=== AddLongIdx ===

This method will add a number to the table that is build with index and data (like the flags table):

bIndex - Index of the data.
bStr - String of the data.

=== Clear ===

This method clears all data in the table.

=== Commit ===

This method commits the data to the table, all changes are not saved to the table until then. (Keep in mind you will also have to save the data to file later in the process using CDataController::Save)

=== DoesLongExists ===

This method checks if a number exists in the table:

lData - The number to search.

Return value - 1 for there, 0 for not found.

=== DoesStringExists ===

This method checks if a string exists in the table:

bString- The string to search.

Return value - 1 for there, 0 for not found.

=== EraseLong ===

This method erases a number entry from the table.

lData - The number to erase.

=== EraseString ===

This method erases a string entry from the table.

bString- The string to erase.

=== GetLong ===

This method retrieves the numeral data associated with a an index.

bString - Index of the data.

Return value - The data (0 if it's not there)

=== GetString ===

This method retrieves the string data associated with a an index.

bString - Index of the data.

Return value - The string data (empty if it's not there)

== DataController ==

This is the main COM class to control the Redirector.

=== GetTable ===

This method is used to retreive system tables that control various aspects of the Redirector functionality.

==== TCP Outgoing tables ====

* dtApplication - Applications to intercept.
* dtPort - Ports to intercept.
* dtIP - IPs to intercept.
* dtApplicationInv - Applications to never intercept.
* dtPortInv - Ports to never intercept.
* dtIPInv - IPs to never intercept.

==== UDP Outgoing tables ====

UDP interception is part of: [[Komodia's Redirector Advanced Version]].

* dtApplicationUDP - Applications to intercept.
* dtPortUDP - Ports to intercept.
* dtIPUDP - IPs to intercept.
* dtApplicationInvUDP - Applications to never intercept.
* dtPortInvUDP - Ports to never intercept.
* dtIPInvUDP - IPs to never intercept.

==== TCP Incoming tables ====

TCP Incoming interception is part of: [[Komodia's Redirector Advanced Version]].

* dtApplicationTCPI - Applications to intercept.
* dtPortTCPI - Ports to intercept.
* dtIPTCPI - IPs to intercept.
* dtApplicationInvTCPI - Applications to never intercept.
* dtPortInvTCPI - Ports to never intercept.
* dtIPInvTCPI - IPs to never intercept.

==== Hard include/exclude ====

* dtHardExclude - Hard exclude applications.
* dtHardInclude - Hard include applications.

==== Flags ====

Flags table (dtFlags) is a index/data type table which holds many settings to control the Redirector.

These are the index values:

* lsprefresh - LSP refresh time, don't change this value without consulting with Komodia first.
* rdenabled - Redirector enable/disable status.
* appinv - TCP outgoing applications inversion flag.
* portinv - TCP outgoing ports inversion flag.
* ipinv - TCP outgoing IPs inversion flag.
* appinvudp - UDP outgoing applications inversion flag.
* portinvudp - UDP outgoing ports inversion flag.
* ipinvudp - UDP outgoing IPs inversion flag.
* appinvi - TCP incoming applications inversion flag.
* portinvi - TCP incoming ports inversion flag.
* ipinvi - TCP incoming IPs inversion flag.
* dlltoload - DLL to load file name.
* disablecache - Disable HTTP caching.
* httpdisable - Disable [[HTTP Parser]] (only if it exists).
* tcprulesand - When true, sets the rules between the applications, ports, and IPs to logical AND instead of logical OR.
* processname - When true and HTTP header processing enabled it will add a header to the outgoing request (X-Process-Name) with the name of the process.
* dllhttponly - When using the DLL framework setting this flag to true will send the DLL only the HTTP methods and not DataBeforeReceive and DataBeforeSend
* intservices - Inverses the services compile time behavior.
* pcdebug - Sets debugging print for callbacks.
* pclog - Enables HTTP Parser traffic logs (only when traffic log is enabled)
* proxysni - When using HTTP Connect proxy, SDK will try to use SNI instead of IP, this will not work 100% because the way browsers and SNI works.
* nocom - Disables COM for LSP, LSP will work via offline file only.
* cdebug - Setting it to 1 will write the classification received into the main log.
* holdhtml - Setting it to 1 will cause any HTML page to be held and only released when the SDK has the entire page.
* kcsppenabled - Setting it to 1 will enable per page classification (only for versions that has this module).
* ddisable - Domains in this flag will not be held by HTTP Parser (you can specify number of domains, and use "," as a delimiter)
* cdebug - Set this flag to 1 to enable classification debug prints.
* comdisableredirect - Disable COM redirect on COM framework error.
* comredirectoncealways - Redirect once, on COM framework error, even if set to disconnect on error is true.
* SSL Digestor:
** ssldisable - Disable SSL Digestor.
** ssldisablecc - Disable handling of SSL client certificates.
** sslinv - When true the SSL exclusion list will become inverted and only apps in the list will be decrypted.
** ssldinv - When true the SSL exclusion list will become inverted and only domains in the list will be decrypted.
** Custom CA: (SDK must be restarted after setting these keys)
*** sslpub - To the path of the public key .pem file.
*** sslprv - To the path of the private key .pem file.
*** sslpsd - To the password of the root CA (it's mandatory).
*** sslforce - The three previous keys only work if the certs inside KomodiaProduct.h don't exist, if there are certs, an override is needed, when sslforce is set to 1, the SDK will use the new certs.

==== Global proxy ====

Proxy table (dtProxy) is a index/data type table which holds many settings to control proxy usage of the Redirector ([[Komodia's Redirector installation guide#Global_proxy_control]]).

These are the index values:

* ip - IP of the proxy.
* port - Port of the proxy.
* username - Username of the proxy.
* password - Password of the proxy.
* type - Type of the proxy, according to this enum:

&lt;pre>
typedef enum _IProxyType
{
	iptHTTP,
	iptHTTPConnect,
	iptHTTPConnectSSL,
	iptHTTPHybrid,
	iptHTTPHybridSSL,
	iptSocks4,
	iptSocks5,
	iptHTTPSSL,
	iptSocks5TCPUDP,
	iptRedirect,
	iptRedirectBypass,
	iptSSLSubst,
	iptNone
} IProxyType;
&lt;/pre>

==== Proxy per application ====

Proxy per application ([[Komodia's Redirector installation guide#Proxy per application]]) table is under the table dtProxyApps, and it is composed of an index with the name of the app, and ~ delimited data with the proxy actual data which is: proxy type (integer using the num)~Proxy IP~Proxy port~Username (optional if needed)~Password (optional if needed)

For example a HTTP Hybrid proxy for Internet Explorer line would look like:

Index: iexplore.exe
Data: 3~127.0.0.1~8080

Or if we wanted to specify a socks5 with username and password:

Index: iexplore.exe
Data: 6~127.0.0.1~1080~admin~adminpass

=== Clear === 

This method will reset the Redirector to its default values.

=== Load ===

This method will load settings from file.

==== Text load ====

Allows to load data from editable mode (without using the API to edit the data):

* LoadFromText- Will Load the data from a file.
* LoadFromString- Will Load the data from a string.

=== Save ===

This method will save settings to a file.

==== Text save ====

Allows to save data in editable mode (without using the API to edit the data):

* SaveToText - Will save the data to a file.
* SaveToString - Will save the data to a string.

=== StopProcess ===

This method will stop the Redirector process, the process will exit gracefully.

=== BroadcastChange ===

This method pushes the Redirector settings immediately, you can read more about it here: [[Komodia's Redirector user experience guide#Rules_update]].

It only effects when rules has been changed, it has no effect when the proxy has been changed.

=== UpdateLSPNow ===

This is needed when you update a proxy that contains a UDP proxy, when you switch to or from a UDP proxy, this method will create or terminate the TCP associate.

=== KillAllConnections ===

Will terminate all existing connections, the terminate will be sent as soon as there's data on the session, this means that an idle connection will be open until a data will be sent/receive.

This method is good if you want to terminate all existing connections when you switch a proxy.

=== GetInstaceID ===

This method gets the instance ID of the Redirector, in case the Redirector was restarted, the instance ID will change, also it gives the ID of the current COM interface (if you are using the COM framework), in case the interface was changed, or there was an error and the interface was removed, this ID will change as well. The format of the ID is GUID and the two IDs are seperated by a comma:

&lt;pre>
GUID,GUID
&lt;/pre>

=== SetEnable ===

This methods changes the Redirector state to normal or bypass (default is normal), when in bypass, traffic that is set to intercepted is going via the Redirector, but isn't processed in any way.

=== IsEnabled ===

This methods gives the state of the Redirector, is it normal or bypass.

=== DownloadFile ===

&lt;pre>
HRESULT DownloadFile(BSTR bURL,
		     BSTR bFile,
		     long lTimeout,
		     [out]long* pTimeout,
		     [out,retval]BSTR* pError);
&lt;/pre>

This method will download a file to the hard driver, parameters:

* bURL - Full URL of the file, including http://
* bFile - Full path of the file to store
* lTimeout - Timeout in miliseconds, 0 is no timeout
* pTimeout - When the function exists, this will contain true if a timeout occurred
* pError - When the function exists, this will contain the error if an error occurred

=== IsLSPInstalled ===

&lt;pre>
typedef enum _ILSPInstall
{
	iliNo=0,
	iliOKSingle,
	iliOKAnd3rdParty,
	iliOnly3rdParty,
	iliFileMissing,
	ili32bitOS
} ILSPInstall;

HRESULT IsLSPInstalled32([out,retval]ILSPInstall* lResult);
HRESULT IsLSPInstalled64([out,retval]ILSPInstall* lResult);
&lt;/pre>

This method will return the state of the LSP installation:

* iliNo - LSP is not installed.
* iliOKSingle - LSP is installed and is single on the stack.
* iliOKAnd3rdParty - LSP is installed and also a 3rd party.
* iliOnly3rdParty - Only 3rd party LSP is installed.
* iliFileMissing - LSP is installed by the DLL itself is missing.
* ili32bitOS - You called the 64bit method on 32bit OS.

You use IsLSPInstalled32 to get 32bit LSP status (you call this always), and IsLSPInstalled64 to get 64bit LSP status, this is called on 64bit OSs only.

=== ForceWFPUpdate ===

When deploying a .ini file from another machine, call this method to make sure the WFP gets the correct settings, the reason is that WFP uses a shadow table, which might be in the .ini from the development machine which will affect WFP update.

= Quick samples =

All quick samples are written using VB6 syntax.

== Adding applications to intercept ==

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtApplications)

'Add the applications
tb.AddString "iexplore.exe"
tb.AddString "firefox.exe"

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

== Setting intercepting of all apps ==

You need to make sure that the app list in the outgoing TCP is clear.

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtFlags)

'Inversing the flag
tb.AddStringIdx("appinv","1")

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

== Adding ports to intercept ==

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtPorts)

'Add the applications
tb.AddString "443"
tb.AddString "80"

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

== Proxy settings ==

=== Setting a global proxy server ===

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtProxy)

'Add the proxy 
tb.AddStringIdx "ip","127.0.0.1"
tb.AddStringIdx "port","8080"
tb.AddStringIdx "type",3

'Optional username and password
tb.AddStringIdxPreserveCase "username","admin"
tb.AddStringIdxPreserveCase "password","pass"

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

=== Clearing the global proxy settings ===

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtProxy)

'Add the proxy 
tb.Clear

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

=== Setting an application proxy server ===

This will set a hybrid HTTP Server for Internet Explorer.

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtProxyApps)

'Add the proxy 
tb.AddStringIdxPreserveCase "iexplore.exe","3~127.0.0.1~8080"

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

=== Removing an application proxy server ===

This will remove entry for Internet Explorer.

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtProxyApps)

'Add the proxy 
tb.EraseString "iexplore.exe"

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

=== Clearing all application proxies ===

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtProxyApps)

'Add the proxy 
tb.Clear

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

=== Getting the value of a specific application proxy ===

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtProxyApps)

'Check if we have a record for Internet Explorer
if tb.DoesStringExists("iexplore.exe") then
    dim ProxyData as string
    ProxyData=tb.GetString("iexplore.exe")
endif
&lt;/pre>

== Setting/Getting flag value ==

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtFlags)

'Inverse the applications status
if tb.GetString("appinv")="1"
    tb.AddStringIdx("appinv","0")
else
    tb.AddStringIdx("appinv","1")
end if

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

== Setting a custom variable ==

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtFlags)

'Set the variable
tb.AddStringIdx "myvar","mydata"

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

== Getting a custom variable ==

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtFlags)

'Set the variable
msgbox tb.GetString("myvar")
&lt;/pre>

== Setting a DLL to load ==

Settings a DLL to load is just setting a variable in the flags (the variable is: "dlltoload")

&lt;pre>
'Get the table
dim dt as new DataController
dim tb as DataTable
set tb=dt.GetTable(dtFlags)

'Set the variable
tb.AddStringIdx "dlltoload","full dll path" 'Full DLL path can look like this: c:\program files\prog\dll.dll
'You can also use system variables: %programfiles%\prog\dll.dll

'Commit the data
tb.Commit

'Save data to file
dt.Save
&lt;/pre>

== HTTP header manipulation ==

Header manipulation is under a container, which has two tables and some flags.

=== Cache control ===

To enable/disable clearing the cache:

&lt;pre>
Dim dt As DataTable
Set dt = dc.GetTable(dtFlags)
    
'This is a checkbox in the form
If DisableCaching = Checked Then
    dt.AddLongIdx "disablecache", 1
Else
    dt.AddLongIdx "disablecache", 0
End If
        
'Save it
dt.Commit
&lt;/pre>

=== Header control ===

To enable/disable the header processing:

&lt;pre>
Dim dt As DataTable
Set dt = dc.GetTable(dtFlags)
    
'This is a checkbox in the form
If DisableCaching = Checked Then
    dt.AddLongIdx "filterhttp", 1
Else
    dt.AddLongIdx "filterhttp", 0
End If
        
'Save it
dt.Commit
&lt;/pre>

=== Managing the header tables ===

The header processing tables are under the container ctHTTPFilter and they are named: filter and custom

==== Adding field to modify/delete ====

&lt;pre>
'Get the DC
Set dc = GetDataController
    
'Get the manager
Dim Mgr As DataTableHolder
Set Mgr = dc.GetContainer(ctHTTPFilter)
    
'Get the table
Dim FilterTbl As DataTable
Set FilterTbl = Mgr.GetTable("filter")

'Add a header to change (for example user-agent)
FilterTbl.AddStringIdx "user-agent","some value"

'Add a header to delete
FilterTbl.AddStringIdx "refer"

'Save changes
FilterTbl.Commit
Mgr.Commit
dc.Save
&lt;/pre>

==== Adding a custom field ====

&lt;pre>
'Get the DC
Set dc = GetDataController
    
'Get the manager
Dim Mgr As DataTableHolder
Set Mgr = dc.GetContainer(ctHTTPFilter)
    
'Get the table
Dim FilterTbl As DataTable
Set FilterTbl = Mgr.GetTable("custom")

'Add a header to change (for example user-agent)
FilterTbl.AddStringIdx "X-customheader","some value"

'Save changes
FilterTbl.Commit
Mgr.Commit
dc.Save
&lt;/pre>

== SSH connect ==

&lt;pre>
Dim sh As New SSHController
sh.SetSSHLogFile TextLog
If sh.CreateSSHSession(SSHText, TimeoutText) &lt;> 0 Then
    MsgBox "Failed to create SSH"
Else
    MsgBox "SSH created"
End If
&lt;/pre>

* SSHText - Contains the SSH connection syntax (learn more at: [[Komodia's Redirector installation guide#SSH_Module]].
* TimeoutText - Timeout in Mili seconds, default is 10000

== Black/white list module ==

=== Enabling the black/white list module ===

&lt;pre>
'Set it
Dim dc As DataController
Set dc = GetDataController
    
'Get the flags
Dim tbl As DataTable
Set tbl = dc.GetTable(dtFlags)
    
'Get the flag
Dim lParental As Long
lParental = tbl.GetLong("parentalcontrol")
    
'Set it
tbl.AddLongIdx "parentalcontrol", 1
    
'Save it
tbl.Commit
&lt;/pre>

=== Disabling the black/white list module ===

&lt;pre>
'Set it
Dim dc As DataController
Set dc = GetDataController
    
'Get the flags
Dim tbl As DataTable
Set tbl = dc.GetTable(dtFlags)
    
'Get the flag
Dim lParental As Long
lParental = tbl.GetLong("parentalcontrol")
    
'Set it
tbl.AddLongIdx "parentalcontrol", 0
    
'Save it
tbl.Commit
&lt;/pre>

=== Setting the module to whitelist mode ===

&lt;pre>
'Get the type
Dim dc As DataController
Set dc = GetDataController
        
'First get the container
Dim tbh As DataTableHolder
Set tbh = dc.GetContainer(ctParentalControl)
        
'Get the table
Dim tbl As DataTable
Set tbl = tbh.GetTable("flags")
        
tbl.AddLongIdx "parentalcontrolwhitelist", 1
        
'This is where any other site will be redirected to (must not include http:// or https://)
tbl.AddStringIdx "whitelistredirect", "www.siteredirect.com"
        
tbl.Commit
tbh.Commit
&lt;/pre>

=== Adding exact domains to the list (black or white) ===

&lt;pre>
'Get the DC
Set dc = GetDataController
    
'Get the manager
Dim Mgr As DataTableHolder
Set Mgr = dc.GetContainer(ctParentalControl)
    
'Get the table
Dim Tbl As DataTable
Set Tbl = Mgr.GetTable("exactdomainblacklist")

'Add a domain
Tbl.AddStringIdx "www.block.com"

'Save changes
Tbl .Commit
Mgr.Commit
&lt;/pre>


=== Adding partial domains to the list (black or white) ===

&lt;pre>
'Get the DC
Set dc = GetDataController
    
'Get the manager
Dim Mgr As DataTableHolder
Set Mgr = dc.GetContainer(ctParentalControl)
    
'Get the table
Dim Tbl As DataTable
Set Tbl = Mgr.GetTable("partialdomainblacklist")

'Add a domain
Tbl.AddStringIdx "www.block.com"

'Save changes
Tbl .Commit
Mgr.Commit
&lt;/pre>
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="index.php/Komodia's_Redirector_API_Guide.html" title="Komodia's Redirector API Guide">Komodia's Redirector API Guide</a>.</p>
</div><div class="printfooter">
Retrieved from "<a href="index.php/Komodia's_Redirector_API_Guide.html">http://www.komodia.com/wiki/index.php/Komodia%27s_Redirector_API_Guide</a>"</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="index.php/Komodia's_Redirector_API_Guide.html" primary="1" context="subject" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.komodia.com/wiki/index.php?title=Talk:Komodia%27s_Redirector_API_Guide&amp;action=edit&amp;redlink=1" primary="1" context="talk" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource" class="selected"><a href="index.php@title=Komodia%2527s_Redirector_API_Guide&amp;action=edit.html" primary="1" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="index.php@title=Komodia%2527s_Redirector_API_Guide&amp;action=history.html" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://www.komodia.com/wiki/index.php/User:46.165.222.245" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">46.165.222.245</a></li>
				<li id="pt-anontalk"><a href="http://www.komodia.com/wiki/index.php/User_talk:46.165.222.245" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
				<li id="pt-anonlogin"><a href="index.php@title=Special%253AUserLogin&amp;returnto=Komodia%2527s+Redirector+API+Guide&amp;returntoquery=action%253Dedit.html" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
<a href="index.php/Main_Page.html" style="background-image: url(http://www.komodia.com/images/logo.png);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.php/Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-Official-homepage"><a href="../index.php.html">Official homepage</a></li>
				<li id="n-recentchanges"><a href="index.php/Special%253ARecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://www.komodia.com/wiki/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" title="Search Komodia [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="index.php/Special%253AWhatLinksHere/Komodia's_Redirector_API_Guide.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="index.php/Special%253ARecentChangesLinked/Komodia's_Redirector_API_Guide.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="index.php/Special%253ASpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="privacy"><a href="index.php/Komodia%253APrivacy_policy.html" title="Komodia:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="index.php/Komodia%253AAbout.html" title="Komodia:About">About Komodia</a></li>
		<li id="disclaimer"><a href="index.php/Komodia%253AGeneral_disclaimer.html" title="Komodia:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-6898822-1");
pageTracker._trackPageview();
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.komodia.com/" : "http://piwik.komodia.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 6);
piwikTracker.setDocumentTitle("");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://piwik.komodia.com/piwik.php?idsite=6" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.178 secs. --></body></html>