<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>View source for Komodia's Redirector troubleshooting guide - Komodia</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.20.4" />
<link rel="next" href="index.php/Komodia's_Redirector_troubleshooting_guide.html" />
<link rel="shortcut icon" href="../favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Komodia (en)" />
<link rel="EditURI" type="application/rsd+xml" href="api.php@action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Komodia Atom feed" href="index.php@title=Special%253ARecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php@debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;%252A.css" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: komod_wikidb:resourceloader:filter:minify-css:7:dffa96a73b1be9b0dae7e17005fcc939 */</style>

<script src="load.php@debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;%252A"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Komodia\'s_Redirector_troubleshooting_guide","wgTitle":"Komodia\'s Redirector troubleshooting guide","wgCurRevisionId":1418,"wgArticleId":36,"wgIsArticle":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Komodia\'s_Redirector_troubleshooting_guide","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: komod_wikidb:resourceloader:filter:minify-js:7:c89fc005766e312c555f83b307d08d63 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Komodia_s_Redirector_troubleshooting_guide skin-monobook action-edit">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading"><span dir="auto">View source for Komodia's Redirector troubleshooting guide</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From Komodia</div>
		<div id="contentSub">‚Üê <a href="index.php/Komodia's_Redirector_troubleshooting_guide.html" title="Komodia's Redirector troubleshooting guide">Komodia's Redirector troubleshooting guide</a></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="index.php@title=Komodia%2527s_Redirector_troubleshooting_guide&amp;action=edit.html#column-one">navigation</a>, <a href="index.php@title=Komodia%2527s_Redirector_troubleshooting_guide&amp;action=edit.html#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://www.komodia.com/wiki/index.php?title=Komodia:Users&amp;action=edit&amp;redlink=1" class="new" title="Komodia:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">When deploying a product for end user there are many variance such as pre-existing LSPs, trying to install from non-admin user, security products, system corruption and more, this guide will go over which logs the Redirector creates, their location and why they are needed.

These logs should not be confused with the "sniffing" log: [[Komodia's Redirector installation guide#Log_control]].

= Common problems =

== Installation ==

The most common "problem" we see in failed installation is because of executing the install/uninstall process without giving UAC privileges. The confusion is because admin user is not UAC enabled by default. The UAC dialog is the one asking for more privileges before installing a software. [http://en.wikipedia.org/wiki/User_Account_Control More on UAC]

== Browsers not intercepted ==

Any process that is open during the LSP install will not be intercepted, make sure to close any running network process.

== SSL Error dialog ==

SSL Certificate error during browsing means the root CA wasn't installed correctly, the SDK installs the certificate on startup, but it will not do so for Firefox and Opera if they are running during the startup process, also IE and Chrome may not use the new root CA if they were open as well, the solution is to close all browsers on first install.

== Not intercepting localhost ==

The SDK only intercepts localhost when it's enabled to do so, it's enabled in the code only.

== Not intercepting services ==

The SDK is configured to either intercept or not intercept services, this can be changed, also you can use the custom flag intservices and set it to 1, this will inverse the SDK default behavior.

== No traffic is intercepted at all ==

First you need to make sure that you receive traffic:

* Enable traffic logging, see if you get the data: [[Komodia's Redirector installation guide#Log_control]].
* If your version have the HTTP Parser then you can use the "Online traffic button" in PCController.

If you don't get traffic then check the following items:

* If using LSPs, that they are registered by running the register LSP app from the command prompt: 
** Using: "registerlsp -p"
** On 64bit machines also check 64 bit LSP: "registerlsp64 -p"
* If using WFP, you can check if it's installed and running from the WFP button on PCController.
* If using WFP, make sure you clicked on save after setting the interception rules.
* Redirector is not in disable mode, press on the "Toggle disable mode" on PCController to see if it's bypassed or not.
* Check Redirection rules, that they are matching the traffic you planned to intercept.
* Check that the browsers have no proxy configured, and if they do, check if the proxy port is inside your redirection rules or not.
** If the 3rd party proxy is on the local machine, make sure you're not intercepting it as well, causing an infinite loop.
* Run "netstat -ao" from command prompt and see which ports the app you're trying to intercept is using, see that they match the interception rules.
** Also see which other application is generating traffic, see if the traffic was intercepted by a 3rd party and is sent to the Internet via a transparent proxy.

== DLL framework is not working ==

Check the following items:

* After you set the DLL you pressed save and restarted the service.
* Check in the logs under c:\windows\temp\pcproxy.log that the DLL was loaded correctly, sometimes DLL are compiled in a way that they have dependencies issues.
* Check that the SDK receives traffic at all, if not troubleshoot with the above methods.

== Can't break point into the DLL with a debugger ==

Check the following items:

* That you receive traffic.
* That the DLL is loaded correctly.
* That you break pointed into pcproxy.exe

== Internet breaks instantly or after a period of time ==

Usually the case is that the client's logic (DLL or COM framework) fails in a way, for example, NewConnection function returning false or crashes.

To verify, install the SDK but don't deploy the software or DLL, and see of traffic is intercepted.

= Logs =

== Uploading logs to server ==

The logs can be uploaded to Komodia's server using the syntax:

&lt;pre>
PCProxy /UploadLogs
&lt;/pre>

The server is not monitored, so you will need to contract us to look at the logs.

== Which logs are always present and which should be enabled ==

* LSP Installer log - Always enabled.
* LSP log - Disabled.
* Service install log - Enabled.
* Service running log - Partially enabled.

== Logs location summary ==

Under the installing user %temp% directory you have:

* RegisterLSP.log
* PCProxy.log
* PCProxyr.log

(PCProxy would be replaced with the binary name you are using)

Under windows temp directory, which is usually: c:\windows\temp you have:

* PCProxy.log
* PCProxyr.log

=== Enabling LSP log ===

==== 32bit OS ====

===== Normal log =====

To enable the log add the value (DWORD): lsplog to the key: HKEY_LOCAL_MACHINE\Software\Komodia

===== Verbose log =====

To enable the verbose log (usualy based on request from Komodia's personal) add the value (DWORD): lspverbose to the key: HKEY_LOCAL_MACHINE\Software\Komodia

==== 64bit OS ====

===== Normal log =====

To enable the log add the value (DWORD): lsplog to the key: HKEY_LOCAL_MACHINE\Software\WOW6432Node\Komodia

===== Verbose log =====

To enable the verbose log (usualy based on request from Komodia's personal) add the value (DWORD): lspverbose to the key: HKEY_LOCAL_MACHINE\WOW6432Node\Software\Komodia

=== Enabling full service log ===

==== 32bit OS ====

The full service log includes details about the interception rules, to enable it add the value (DWORD): pcproxy to the key: HKEY_LOCAL_MACHINE\Software\Komodia

==== 64bit OS ====

===== 32bit PCProxy =====

The full service log includes details about the interception rules, to enable it add the value (DWORD): pcproxy to the key: HKEY_LOCAL_MACHINE\Software\WOW6432Node\Komodia

===== 64bit PCProxy =====

The full service log includes details about the interception rules, to enable it add the value (DWORD): pcproxy to the key: HKEY_LOCAL_MACHINE\Software\Komodia

== LSP installation ==

RegisterLSP.EXE or it's DLL or COM equivilence creates a log called "RegisterLSP.log" under the %temp% directory of the installing user, this log has the following information inside:

* OS (and 32/64 bit)
* Was it UAC provided (on Vista and above OS)
* RegisterLSP location
* Working directory
* Existing security products (that the RegisterLSP is aware of)
* Install outcome

LSP installation problems are seen right away in the install log.

== Service installation ==

The service creates an install log under the %temp% directory of the installing the user, the log name is usualy the process name with the letter 'r', for example the default log name for: "PCProxy.exe" is "PCProxyr.log", this name can be changed for clients with the source code.

This log has the following information inside:

* OS (and 32/64 bit)
* Was it UAC provided (on Vista and above OS)
* Redirector location
* Working directory
* Install outcome

== Service run log ==

The service creates a run log under the %temp% of the running user, because the Redirector is a service under the Local System account this temp directory is c:\windows\temp

The log contains the steps taken to run the process.

== What to do with the logs ==

In case of a problem, make sure to collect these three logs and you can always forward them to Komodia's support personal for further assistance.

= Other topics =

== DCOM event message ==

On some computers DCOM error events may appear in event log, to resolve this:

# Go to Administrative tools, select component services, in component services directory select computers, then My Computer, now select DCOM Config.
# In DCOM Config, highlight PCProxy, right click and select properties and then the security tab.
# In the Launch and Activation Permissions select edit 
# Add the Group named ?Service? and select all four permissions for the service (local launch, remote launch, local activation, remote activation).
# Reboot and problem should now disappear.

= Suggestion for a loopback test =

Some users may want to implement a method to check they still have network after the LSP is installed in case there is some sort of conflict, this method is not 100%, but there are some issues that have to be addressed to make the loopback test more reliable, these are the steps to take:

# Before installing the LSP save name and addresses of all interfaces (can be done with IP Helper API)
# Contact your web server, send some data, and see that you get an expected result back.
# Install the LSP.
# If you are in the same app that made the test, make sure to unload Winsock and then reload it, so the new LSP will be loaded as well.
# Verify that the network didn't change, if it did, you may not have Internet and the test will fail regardless of the LSP state.
# Do the web server test again, if there was no reply it may be that there's no Internet connection or there was a LSP conflict.

= 32bit and 64bit =

If you changed processes from 32bit to 64bit or vice versa on the same machine, make sure you uninstalled the process of the original version.

= Watchdog =

Here is a list of some common problems when using the [[Komodia's Watchdog]] and how to resolve them.

== SDK is not protected ==

You can delete registry keys belonging to the SDK, delete the service or the LSP with netsh. You need to check that:

# You installed the WD.
# You called "Add redirector rules" (which adds the rules to protect the SDK).
# You uploaded the rules to the WD.

== I added registry rules but they aren't protected ==

When adding registry rules you usually also wants to protect all subkeys and values, in that case you need to add * or \* to the end of the key.

Also not that some registry keys are links (HKEY_CURRENT_USER and HKEY_CLASSES), the WD is a driver and sees only real keys, so you need to give it the full key and not the links.

== I tried to protect a directory, but it isn't protected ==

The WD doesn't support in protecting directories.

== I tried using the 64bit WD but I'm getting errors ==

When you try to install the WD when it's not signed correctly (signed and cross signed), or not signed at all you will get error 577 and a warning from the OS, you can verify it if you boot with digital driver signature enforcement turned off, if the driver loads then, you know it's your signature.

== I signed my 64bit WD but it's not protecting or I'm still getting errors ==

Doing a cross sign is not simple, and it may have been done incorrectly (not using the correct cross sign cert), or it's not done from XP, you can read more about it here: [http://www.globalsign.com/support/code-signing/codesign_vista64.php why you should sign from a XP machine].

== My 32bit WD works perfectly on XP/Vista but some registry keys are not protected on Win7 ==

There are two drivers for 32bit, one for XP/Vista and one for Win7, make sure you deploy them correctly.
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="index.php/Komodia's_Redirector_troubleshooting_guide.html" title="Komodia's Redirector troubleshooting guide">Komodia's Redirector troubleshooting guide</a>.</p>
</div><div class="printfooter">
Retrieved from "<a href="index.php/Komodia's_Redirector_troubleshooting_guide.html">http://www.komodia.com/wiki/index.php/Komodia%27s_Redirector_troubleshooting_guide</a>"</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="index.php/Komodia's_Redirector_troubleshooting_guide.html" primary="1" context="subject" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.komodia.com/wiki/index.php?title=Talk:Komodia%27s_Redirector_troubleshooting_guide&amp;action=edit&amp;redlink=1" primary="1" context="talk" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource" class="selected"><a href="index.php@title=Komodia%2527s_Redirector_troubleshooting_guide&amp;action=edit.html" primary="1" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="index.php@title=Komodia%2527s_Redirector_troubleshooting_guide&amp;action=history.html" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://www.komodia.com/wiki/index.php/User:46.165.222.245" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">46.165.222.245</a></li>
				<li id="pt-anontalk"><a href="http://www.komodia.com/wiki/index.php/User_talk:46.165.222.245" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
				<li id="pt-anonlogin"><a href="index.php@title=Special%253AUserLogin&amp;returnto=Komodia%2527s+Redirector+troubleshooting+guide&amp;returntoquery=action%253Dedit.html" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
<a href="index.php/Main_Page.html" style="background-image: url(http://www.komodia.com/images/logo.png);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.php/Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-Official-homepage"><a href="../index.php.html">Official homepage</a></li>
				<li id="n-recentchanges"><a href="index.php/Special%253ARecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://www.komodia.com/wiki/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" title="Search Komodia [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="index.php/Special%253AWhatLinksHere/Komodia's_Redirector_troubleshooting_guide.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="index.php/Special%253ARecentChangesLinked/Komodia's_Redirector_troubleshooting_guide.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="index.php/Special%253ASpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="privacy"><a href="index.php/Komodia%253APrivacy_policy.html" title="Komodia:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="index.php/Komodia%253AAbout.html" title="Komodia:About">About Komodia</a></li>
		<li id="disclaimer"><a href="index.php/Komodia%253AGeneral_disclaimer.html" title="Komodia:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-6898822-1");
pageTracker._trackPageview();
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.komodia.com/" : "http://piwik.komodia.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 6);
piwikTracker.setDocumentTitle("");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://piwik.komodia.com/piwik.php?idsite=6" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.187 secs. --></body></html>