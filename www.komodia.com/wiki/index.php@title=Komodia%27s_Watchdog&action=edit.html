<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>View source for Komodia's Watchdog - Komodia</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.20.4" />
<link rel="next" href="index.php/Komodia's_Watchdog.html" />
<link rel="shortcut icon" href="../favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Komodia (en)" />
<link rel="EditURI" type="application/rsd+xml" href="api.php@action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Komodia Atom feed" href="index.php@title=Special%253ARecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="load.php@debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%252Cshared%257Cskins.monobook&amp;only=styles&amp;skin=monobook&amp;%252A.css" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/monobook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/monobook/IE70Fixes.css?303" media="screen" /><![endif]--><meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: komod_wikidb:resourceloader:filter:minify-css:7:dffa96a73b1be9b0dae7e17005fcc939 */</style>

<script src="load.php@debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook&amp;%252A"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Komodia\'s_Watchdog","wgTitle":"Komodia\'s Watchdog","wgCurRevisionId":1415,"wgArticleId":18,"wgIsArticle":false,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":true,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Komodia\'s_Watchdog","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"monobook","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,
"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});
/* cache key: komod_wikidb:resourceloader:filter:minify-js:7:c89fc005766e312c555f83b307d08d63 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Komodia_s_Watchdog skin-monobook action-edit">
<div id="globalWrapper">
<div id="column-content"><div id="content" class="mw-body-primary">
	<a id="top"></a>
	
	<h1 id="firstHeading" class="firstHeading"><span dir="auto">View source for Komodia's Watchdog</span></h1>
	<div id="bodyContent" class="mw-body">
		<div id="siteSub">From Komodia</div>
		<div id="contentSub">‚Üê <a href="index.php/Komodia's_Watchdog.html" title="Komodia's Watchdog">Komodia's Watchdog</a></div>
		<div id="jump-to-nav" class="mw-jump">Jump to: <a href="index.php@title=Komodia%2527s_Watchdog&amp;action=edit.html#column-one">navigation</a>, <a href="index.php@title=Komodia%2527s_Watchdog&amp;action=edit.html#searchInput">search</a></div>
		<!-- start content -->
<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://www.komodia.com/wiki/index.php?title=Komodia:Users&amp;action=edit&amp;redlink=1" class="new" title="Komodia:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page:
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">= Introduction =

Komodia's watchdog is a kernel driver that is used to protect [[Komodia's Redirector]] SDK from being removed, modified or terminated by the user whether he is administrator or a standard user.

= Features =

The watchdog provides the following protection mechanisms:

== Fully protect a file ==

The file protected will neither be accessable to any application nor can it be deleted or modified, the only way to access that file is either remove the protection or tell the watchdog to allow a process (using the PID) to access that file.

== Read only protect a file ==

The file protected will be accessable to all application, but as read only, it can neither be modified nor deleted.

== Protect registry ==

The protection applies to a single key and its values and it can also be applied to a key and all its sub keys, the protection is for read only and the key/subkeys/values can neither be modified nor deleted.

== Process protection ==

The process will be protected against termination, the process can neither be terminated by "end task" nor by any other means, this applies to windowless processes only, if you want to protect a window process you need to create a service that monitors it and every time it goes down restart that process and use the watchdog to protect the process.

== Level of protection ==

Because the Watchdog offers high level of protection some operations that may be legit are forbidden: 

# When protecting the LSP, you will not be able to remove any existing LSP or install new LSP, even if it's legit like a LSP that is part of an AV, because there is no way to know how the LSP removal/install will affect the installed LSP.
# The Watchdog must be disabled before installing a OS Service Pack.
# The Watchdog can't protect processes that accept WM_QUIT or has GUI.
# When protecting a process the Watchdog denies all write access to the process, some WinAPI functions calls (specially token/security) causes the OS to use svchost and request write access to the process (even if the function is read only) which will be disabled by the Watchdog.
# When protecting the LSP stack you can't install any SP because they require to change the stack.

= Installation and usage =

== Introduction ==

To add rules you first set the rules using the GUI which caches them at the Redirector service and when you are done setting the rules you upload them to the driver, when you want to remove the rules you clear them from the driver, but the list is still cached inside the Redirector.

== Signing ==

You can find instructions on how to sign the WD here: [[Signing and cross signing files]].

== Installing ==

# Run: install.bat (if under Vista of Windows7 please run it under UAC enabled command prompt)
# Now goto the "Watchdog" button in the main screen of "PCController.exe", when the watchdog is not installed you should see the status as not running and not installed, like in the sample picture:

[[Image:WatchdogMain.png]]

Click "Install watchdog", you should see the watchdog status changed to installed and running:

[[Image: WatchdogInstalled.png]]

== Adding rules to protect the SDK ==

First rules you want to install are the rules to protect the SDK, you can do that by clicking on: "Add redirector rules", this will fill the four rules boxes with rules according to the installation path and name, all names are case insensitive.

From the SDK point of view all the needed rules have been set, adding more rules is used only to protect user specific files.

=== What is protected ===

# LSP registration, you will not be able to install any additional LSP, or remove the LSP, also protects against common LSP removal tools.
# Service registration, you will not be able to delete the service.
# COM registration, you will not be able to delete the COM entries in the registry.
# Proxy service, can't be killed from task manager.
# SDK files, you will not be able to delete them.

== Adding rules to protect user's data ==

=== Adding read only protection to files ===

To add a read only file protection write the full path of the file, i.e. c:\test.txt to the: "Files that will be read only".

=== Adding full protection to files ===

To add full protection to files write the full path of the file, i.e. c:\test.txt to the: "Files that will be fully protected".

=== Adding process to protect ===

To add protection against termination add the full process path, i.e. c:\PCProxy.exe to the: "Processes that can't be stopped.

=== Adding registry keys and values to protect ===

To add key read only protection you need to add the key name to the: "Registry keys". Use these guidelines to decide how you want to protect the keys:

* Add the key name to protect only the key and its values.
* Add the key name with astrix at the end to protect the key, sub keys and all values and the sub keys' values:

&lt;pre>
hkey_local_machine\software\classes\appid*
&lt;/pre>

* To add keys under CurrentControlSet use the following method:

&lt;pre>
hkey_local_machine\system\controlset*\rest of key name
&lt;/pre>

== Uploading the rules ==

To upload the rules press the "Upload rules to watchdog" button, this will update the driver with the rules and greyout the rules so you can't edit them, you will be able to edit them again after you remove the rules from the driver, the rules will look somehow like this:

[[Image: WatchdogRulesU.png]]

== Setting trusted processes ==

Trusted process is a process that is able to access a fully protected file, to add such process press the "Add trusted PID" button and specify the PID that process, keep in mind that this is a non persistant value and as soon as this process ends, the PID is removed from the driver.

== Locking the INI file ==

After you uploaded the rules to the driver you will be able to lock the INI file against modifications, to do that press the "Lock INI file" button, keep in mind that after you locked the file you will not be able to save settings or remove the rules from the driver until you unlock it.

== Unlocking the INI file ==

Press the "Unlock INI file" button.

== Removing rules from the watchdog ==

Press the "Remove rules from watchdog" button, the rules will be removed from the driver but still cached at the Redirector.

== Uninstalling ==

To uninstall the watchdog press the "Uninstall watchdog" button. Don't install the watchdog again in this session, you must reboot the OS before you can install it again. Also please make sure you uninstall the watchdog before you uninstall the SDK.

== Updating ==

=== Without uninstalling ===

# Stop the Watchdog
# Replace the Watchdog files under system32\drivers
# Reboot

=== With uninstalling ===

# Uninstall the Watchdog
# Reboot
# Install the Watchdog

= FAQ =

== Why do I need a special version for 32bit and 64bit? ==

32bit kernel is different then 64bit kernel, that's why you need a specialized driver for 32bit and 64bit.

== Do I need any thing else for the 64bit driver? ==

Yes, to distribute the 64bit watchdog you must sign it with a special SPC certificate as specified here: [http://msdn.microsoft.com/en-us/library/windows/hardware/gg487315.aspx MSDN on 64bit driver signing].

== Kernel Watchdog vs User mode Watchdog ==

=== Kernel Watchdog pros/cons ===

Pros:

* Hard to remove.

Cons:

* Hard to justify with AV companies (unless you're doing parental control).

=== User mode Watchdog pros/cons ===

Pros:

* Non invasive.

Cons:

* Moderate level of protection, power user can find a way to remove it.

= Troubleshooting =

You can read the WD trouble shooting guide: [[Komodia's Redirector troubleshooting guide#Watchdog]].

= Common pitfalls =

== Not signing the Watchdog correctly ==

The 64bit Watchdog must be cross signed, many time this fails because of various reasons and then the Watchdog can't be installed. You must verify that the cross sign was completed successful before deploying the Watchdog . The 32bit Watchdog must be signed regularly (not cross signed)

== Not deploying the right version ==

The 32bit WD has two versions, one for Windows XP/Vista and one for Windows 7/8, make sure you deploy the right version based on the OS.
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="index.php/Komodia's_Watchdog.html" title="Komodia's Watchdog">Komodia's Watchdog</a>.</p>
</div><div class="printfooter">
Retrieved from "<a href="index.php/Komodia's_Watchdog.html">http://www.komodia.com/wiki/index.php/Komodia%27s_Watchdog</a>"</div>
		<div id='catlinks' class='catlinks catlinks-allhidden'></div>		<!-- end content -->
				<div class="visualClear"></div>
	</div>
</div></div>
<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
				<li id="ca-nstab-main" class="selected"><a href="index.php/Komodia's_Watchdog.html" primary="1" context="subject" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.komodia.com/wiki/index.php?title=Talk:Komodia%27s_Watchdog&amp;action=edit&amp;redlink=1" primary="1" context="talk" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource" class="selected"><a href="index.php@title=Komodia%2527s_Watchdog&amp;action=edit.html" primary="1" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="index.php@title=Komodia%2527s_Watchdog&amp;action=history.html" rel="archives" title="Past revisions of this page [h]" accesskey="h">History</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-anonuserpage"><a href="http://www.komodia.com/wiki/index.php/User:46.165.222.245" class="new" title="The user page for the IP address you are editing as [.]" accesskey=".">46.165.222.245</a></li>
				<li id="pt-anontalk"><a href="http://www.komodia.com/wiki/index.php/User_talk:46.165.222.245" class="new" title="Discussion about edits from this IP address [n]" accesskey="n">Talk for this IP address</a></li>
				<li id="pt-anonlogin"><a href="index.php@title=Special%253AUserLogin&amp;returnto=Komodia%2527s+Watchdog&amp;returntoquery=action%253Dedit.html" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
			</ul>
		</div>
	</div>
	<div class="portlet" id="p-logo">
<a href="index.php/Main_Page.html" style="background-image: url(http://www.komodia.com/images/logo.png);" title="Visit the main page"></a>
	</div>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class='pBody'>
			<ul>
				<li id="n-mainpage-description"><a href="index.php/Main_Page.html" title="Visit the main page [z]" accesskey="z">Main page</a></li>
				<li id="n-Official-homepage"><a href="../index.php.html">Official homepage</a></li>
				<li id="n-recentchanges"><a href="index.php/Special%253ARecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
			</ul>
		</div>
	</div>
	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://www.komodia.com/wiki/index.php" id="searchform">
				<input type='hidden' name="title" value="Special:Search"/>
				<input type="search" name="search" title="Search Komodia [f]" accesskey="f" id="searchInput" />
				<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />&#160;
				<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
			</form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="index.php/Special%253AWhatLinksHere/Komodia's_Watchdog.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="index.php/Special%253ARecentChangesLinked/Komodia's_Watchdog.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
				<li id="t-specialpages"><a href="index.php/Special%253ASpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			</ul>
		</div>
	</div>
</div><!-- end of the left (by default at least) column -->
<div class="visualClear"></div>
<div id="footer">
	<div id="f-poweredbyico">
		<a href="http://www.mediawiki.org/"><img src="skins/common/images/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" width="88" height="31" /></a>
	</div>
	<ul id="f-list">
		<li id="privacy"><a href="index.php/Komodia%253APrivacy_policy.html" title="Komodia:Privacy policy">Privacy policy</a></li>
		<li id="about"><a href="index.php/Komodia%253AAbout.html" title="Komodia:About">About Komodia</a></li>
		<li id="disclaimer"><a href="index.php/Komodia%253AGeneral_disclaimer.html" title="Komodia:General disclaimer">Disclaimers</a></li>
	</ul>
</div>
</div>
<script>if(window.mw){
mw.loader.state({"site":"loading","user":"missing","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready","mediawiki.searchSuggest"], null, true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-6898822-1");
pageTracker._trackPageview();
</script><!-- Piwik -->
<script type="text/javascript">
/* <![CDATA[ */
var pkBaseURL = (("https:" == document.location.protocol) ? "https://piwik.komodia.com/" : "http://piwik.komodia.com/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
/* ]]> */
</script>
<script type="text/javascript">
/* <![CDATA[ */
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 6);
piwikTracker.setDocumentTitle("");
piwikTracker.setIgnoreClasses("image");

piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
/* ]]> */
</script><noscript><p><img src="http://piwik.komodia.com/piwik.php?idsite=6" style="border:0" alt=""/></p></noscript>
<!-- /Piwik --><!-- Served in 0.186 secs. --></body></html>